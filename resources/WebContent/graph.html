<!DOCTYPE html>
<html lang="en">
<!--
at gorans:
	chmod 666 /home/sybase/dbxtune/0/resources/WebContent/graph.html /home/sybase/dbxtune/0/resources/WebContent/scripts/dbxcentral.graph.js
at pc:
	cd /mnt/c/projects/DbxTune/resources/WebContent
	scp graph.html gorans@gorans.org:/home/sybase/dbxtune/0/resources/WebContent/; scp scripts/dbxcentral.graph.js gorans@gorans.org:/home/sybase/dbxtune/0/resources/WebContent/scripts/
-->
<head>
	<meta charset="UTF-8">
	<title>Graph/Chart Subscribe 2</title>

	<!-- HARD Refresh every 24 hour, so that "long running" stuff like "Dashboards" etc gets new javascript code every now and then  -->
	<meta http-equiv="refresh" content="86400">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />

	<!-- Prism: SQL Text Area needs this -->
	<!-- Done up here since we OVERRIDE some of the stuff in below -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">

	<!-- SQL Server SHOWPLAN -->
	<!-- Done up here since we OVERRIDE some of the stuff in below -->
	<link href="https://cdn.jsdelivr.net/npm/html-query-plan@2.6.1/css/qp.min.css" rel="stylesheet">

	<style>
		/* html-query-plan ... tooltip show on modal */
		.qp-tt {
			z-index: 99999;
		}

		canvas {
			user-select: none;
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
			/* width: 100% !important; */
			/* height: auto !important; */
		}

		#progressDiv {
			position: -webkit-sticky; /* Safari */
			position: sticky;
			top: 56px; /* navbar is 56px high */
		}

		@keyframes blink {
			0% { opacity: 1.0; }
			50% { opacity: 0.0; }
			100% { opacity: 1.0; }
		}

		.image-unchecked {
			width:16px;
			height:16px;
			background-repeat: no-repeat;
			background-position: center;
			background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RTRBMEQyNTU1OUFBMTFFMkIwMERBRDZGM0NFNENENzUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RTRBMEQyNTY1OUFBMTFFMkIwMERBRDZGM0NFNENENzUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNEEwRDI1MzU5QUExMUUyQjAwREFENkYzQ0U0Q0Q3NSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFNEEwRDI1NDU5QUExMUUyQjAwREFENkYzQ0U0Q0Q3NSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PotIZFcAAAEoSURBVHjanJNBTgMxDEVtJ3Q9PQMHYYnEEZA4QDcchgUXqLgCYssNukBij8QO1ErAok0c853pMLDphEbKZCZjv9g/Nt/ePayTale0kNH0YEwJQichbBaX5/PoztdXF/TfcbO873wVK0bHjMEv+kPNsEFUSpl0FBFiGb8rYJuUsN0GwMFFx6iji7JLGaJEAKbTQayUNFcx+wjwtsuKRZojcPuBEP0tZUTAgbQB4Hft9gMhskcADWahNAGMenvmXxo4MUMYbdEAN+b2fzUAUWelOQW3pzECrhsZpey3YAcK2m0NBVNT2BNqSeTc94Hx4RT8v+3tf+pAhEmx/fr2DnpDM+HgEAK5XwV8fX48rlbPZ+5sDQQGwSGq+WXozlPM7oh+2uLAp28BBgB476Ywykj6VwAAAABJRU5ErkJggg==);
		}

		.image-checked {
			width:16px;
			height:16px;
			background-repeat: no-repeat;
			background-position: center;
			background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAhVJREFUeNqkUz1oFEEU/uZnf+7iJTGCgkJAgmBAgoUgSVCJjVhcI3hwFlECQVAEBVNZKJjYpEwXEkHFyKmVTbBKFdRYqKXFGYggiBEE4XKX3dnxzeztZrxCFN8yy77hfd/73s8yrTX+x6R5nb31dLW5rUZUkvwVSHCO0Bc/lmcquy2BAa/MVqFbDfxJDzMPY4AfYmzqSW+uQCmTWePz102kFbEOIB0uIZkPwTj2HgihkjQVh4UaS8ApyARyIZxDQBmi6Pdg7VsN51/2ObRtBXlDpERiJeg8SBBhKHbh1ZdHWPxwFSW2U45DYByBYlBCnMQkL4KZjlEUSgJvPMT820kUSO9WnKVzSrCNIbtYK2Kz8YmIuhEGXSgVerBSn8P86wkUKD5pAdeHF1O4dgnaclgETC8fxffGOrq7QiysXsDjtRsIKDYm8JXRBzg5MNHOr3dKyBxPpSQzL4Yw1F/Gm/ozBCaIC0yeuo/RQ+OIVItAPuAqyJzTgxUk2zTWVhPv6s8hidDXDHfPfcSJw+OIdURT0lZz1uZ0jDrdwMtnaqgcv4Noi+6aGh5dT1fr2N83QM1VVqvZQtd457aVR27jWnkJjLp979I69u05aIckBYPvSXieB3fVbA+k+J3n2GAVC3TcNLwjV4axBD7XG2M3l/pjWmmdT4W1m6vzJmcT8wgcePyn9c08aQ+O0Hfwj3+yIuz7XwIMANPJsyJzXkTpAAAAAElFTkSuQmCC);
		}

		.active-statement-row-multi-sampled {
			background-color: orange;
		}
		.active-statement-row-holding-locks-while-idle {
			background-color: gold;
		}
		.active-statement-row-blocking {
		/*	background-color: red; */
			background-color: rgb(220, 20, 60); /* slightly darker red, so RED(blocking) text can be "visible" on the "red" background... possibly 'mix-blend-mode: difference' could be a solution, but I didn't get it to work */
		}
		.active-statement-row-blocked {
			background-color: pink;
		}
		.active-statement-row-waiting-for-memory-grant {
			background-color: lightblue;
		}

		.active-statement-cell-abs {
			color: black;
		}
		.active-statement-cell-diff {
			color: blue;
		}
		.active-statement-cell-rate {
			color: blue;
		}
		.active-statement-cell-pct {
			color: red;
		}

/* ------------------------------------------------------------------------------
   ----- active-statements-srv-class & active-statements-srv-info-class
   ----- id we want srvName to be "sticky" but the table to be scrollable left-right.
   ----- But this doesnt seem to work... on refresh the scroll are always reset to the left (so it forgets where we are in the scroll)
   ------------------------------------------------------------------------------
		.active-statements-srv-class {
			position: relative;
			width: 100%;
			overflow-x: scroll;
		}
		.active-statements-srv-info-class {
			position: sticky;
			left: 0;
			display: inline-block;
		}
		.active-statements-srv-tab-class {
			overflow-x: scroll;
		}
*/
/*
		.active-statements-srv-info-class {
//			position: fixed;
			position: sticky;
			left: 10;
//			scroll-snap-align: start;
		}
*/

		#active-statements-win-size {
			border: 1px solid gray;
			border-radius: 5px;
/*			padding: 1px;*/
			margin-left: 20px;
			padding-left: 3px;
		}
		#active-statements-counter-type {
			border: 1px solid gray;
			border-radius: 5px;
/*			padding: 1px;*/
			margin-left: 20px;
			padding-left: 3px;
		}
		#active-statements-options {
			border: 1px solid gray;
			border-radius: 5px;
/*			padding: 1px;*/
			margin-left: 20px;
			padding-left: 3px;
		}

		#active-statements-btn {
/*			width: 40px;*/
			width: 50px;
			height: 30px;
/*			background: rgba(0, 98, 79, 0.5);*/ /*#009879;*/
			background: rgba(32, 32, 32, 0.5);
			display: flex;
			align-items: center;
			justify-content: center;
			text-decoration: none;
/*			border-radius: 50%;*/
			border-radius: 10px 0px 0px 10px;
			color: #ffffff;
			font-size: 15px;

			box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.25);
			position: fixed;
/*			right: 20px;*/
			right: 0px;
			top: 85px;
			transition: background 0.25s;

			/* for button */
			outline: blue;
			border: none;
			cursor: pointer;
		}
		#active-statements-btn:active {
			background: rgba(0, 0, 0, 1);
		}
/*
		#active-statements-top {
			position: fixed;
			color: rgba(255, 148, 20, 1.0);
			top: 10px;
			font-size: 24px;
			left: 40%;
			z-index: 9999;
			animation: blink 1.5s infinite;
		}
*/

		#active-statements-watermark {
			position: fixed;
				/* center the element */
				right: 0;
				left: 0;
				margin-right: auto;
				margin-left: auto;
			transform: rotate(-45deg);
			font-size: 50px;
			font-weight: bold;
			z-index: 999;
			opacity: 0.5;
			color: gray;
			text-align: center;

			user-select: none; /* Non-prefixed version for chorme, opera and*/
			-ms-user-select: none; /* Internet Explorer, Edge */
			-moz-user-select: none; /* Firefox */
			-khtml-user-select: none; /* Konqueror HTML */
			-webkit-touch-callout: none; /* iOS Safari */
			-webkit-user-select: none; /* Safari */

		}

		#active-statements {
			position: fixed;
			top: 115px;
			left: 25px;
			max-height: 80%;
			width: 95%;
			overflow: auto;
		/*	background-color: rgba(255, 195, 83, 1); */
			background-color: rgba(229, 228, 226, 1);
			border: 2px solid dark-gray;
			border-radius: 5px;

			padding-top: 10px;
			padding-bottom: 10px;
			padding-right: 10px;
			padding-left: 10px;
		}

		#active-statements-ctl {
			position: -webkit-sticky; /* Safari */
			position: sticky;
			top: 0;
			left: 0;
		}

		#active-alarms-top {
			position: fixed;
			color: rgba(255, 148, 20, 1.0);
			top: 10px;
			font-size: 24px;
			left: 40%;
			z-index: 9999;
			animation: blink 1.5s infinite;
		}

		#active-alarms {
			position: fixed;
			bottom: 0;
			max-height: 30%;
			width: 100%;
			overflow: auto;
			/* background-color: rgb(255, 195, 83); */
			background-color: rgba(255, 195, 83, 0.5);
		}

		#active-alarms-ctl {
			position: -webkit-sticky; /* Safari */
			position: sticky;
			top: 0;
			left: 0;
		}

		/* Show "navbar" fixed to the top */
		/*body {
			min-height: 75rem;
			padding-top: 4.5rem;
		}*/
		.dbx-nav-button {
			border: none;
			/* padding: 0; */
			background: none;
			color: rgb(182, 187, 255)
		}
		/*
		 .dbx-nav-button:hover {
			background-color:white;
			color:black;
		}
		*/

		.dbx-nav-text {
			color: white
		}
		/*
		.dbx-nav-text:hover {
			background-color:white;
			color:black;
		}
		*/

		.modal-content.ui-resizable {
			/* overflow: scroll; */
		}

		/*
		** Hide lower "south-east" rezize "handler" image
		** However this disn't work as expected...
		** https://stackoverflow.com/questions/10801676/removing-handle-image-from-jquery-ui-resizable-element
		.ui-icon { background-image: url("") !important; }
		.ui-dialog .ui-resizable-se {
			background-image: url("");
		}
		*/

		.modal-body {
			height: 600px;
			/* height: 80%; */
			/* width: 70%; */
			/* width: 900px; */
			overflow: hidden;
		}
		.modal-body:hover {
			overflow-x: auto;
			overflow-y: auto;
		}




        /* The below data-tooltip is used to show Actual exected SQL Text, as a tooltip where a normalized text is in a table cell */
        [data-tooltip] {
            position: relative;
        }

        /* 'tooltip' CSS settings for SQL Text... */
        [data-tooltip]:hover::before {
/*            content: attr(data-tooltip);		*/
            content: 'Click to Open Text Dialog...';
            position: absolute;
            z-index: 103;
            top: 20px;
            left: 30px;
/*            width: 1800px;					*/
            width: 220px;
            padding: 10px;
            background: #454545;
            color: #fff;
            font-size: 11px;
            font-family: Courier;
            white-space: pre-wrap;
        }
        [data-title]:hover::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 8px;
            border: 8px solid transparent;
            border-bottom: 8px solid #000;
        }

        /* SQL Text Content in modal view */
        .dbx-view-sqltext-content {
            font-size: 11px;
            white-space: pre-wrap;
        }

        /* Override some 'prism' formatting to be smaller & wrap long lines */
        code[class*=language-], pre[class*=language-] {
            font-size: 11px;
            white-space: pre-wrap;
        }

		.dbx-history-container-class {
		}

		.dbx-history-container-div {
			margin: 0px;
			width: 100%;
		}
		.dbx-history-slider-xxx-class {
			-webkit-appearance: none;
			width: 100%;
			height: 10px;
			border-radius: 5px;
			background: #d3d3d3; /* light gray */
			outline: none;
/*			opacity: 0.8;*/
			-webkit-transition: .2s;
			transition: opacity .2s;
		}

		.dbx-panel-below-navbar {
			position: sticky;
			top: 56px;
/*			z-index: 11;*/

/*			position: fixed; */
/*			top: 30;         */
/*			width: 100%;     */

/*			position: fixed;        */
/*			background: #ffc;       */
/*			top: 30;                */
/*			right: 0;               */
/*			left: 0;                */
/*			padding: 10px 10px 0;   */
/*			height: 30px;           */
/*			z-index: 1;             */
		}

		#dbx-history-slider .ui-slider-handle {
/*			outline: 5;     */
/*			height: 1.2em;  */
			width: 10px;
			height: 10px;
			background: DodgerBlue;
			border-radius: 50%;
			top: 0em;
		}

		#dbx-history-slider.ui-slider-horizontal {
/*			top: 1em;     */
/*			left: 10px;   */
			height: .5em; 
/*			width: 99%;   */
			border: none;
			background: #ccc;
		}

		.dbx-history-timeline-slider-class {
			width: 100%;
			margin: 1px auto;
		/*	margin-top: 0px; */
		/*	margin-bottom: 0px; */
		/*	margin-right: 10px; */
		/*	margin-left: 10px; */
			position: relative;
		/*	z-index: 1;*/

			-webkit-appearance: none;
			width: 100%;
			height: 10px;
			border-radius: 5px;
/*			background: #d3d3d3;*/
			outline: none;
			opacity: 0.7;
			-webkit-transition: .2s;
			transition: opacity .2s;
		}

		.dbx-history-timeline-slider-marker {
			position: absolute;
			width: 2px;
			height: 5px;
/*			background-color: orange;*/
/*			background-color: green;*/
/*			border-radius: 50%;*/
			top: 25px;
			transform: translateY(-50%);
		/*	z-index: 2;*/
		}

		#dbx-history-label-top {
			position: fixed;
			color: rgba(104, 141, 252, 1.0);
			top: 10px;
			font-size: 24px;
			left: 40%;
			z-index: 9999;
			animation: blink 1.5s infinite;
		}

/*
		#dbx-history-get-data-bussy {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);

			font-size: 24px;
			z-index: 10000;
		}
*/
		#dbx-history-get-data-bussy {
			position: fixed;
			top: 20%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 10000;

			margin: auto;
			border: 10px solid #EAF0F6;
			border-radius: 50%;
			border-top: 10px solid #242add;
			width: 100px;
			height: 100px;
			animation: spinner 1s linear infinite;
		}
		@keyframes spinner {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

	</style>

	<!--
	  =======================================================================
	  == JS imports - JAVA SCRIPTS GOES HERE
	  =======================================================================
	-->
	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
	<!-- Custom styles for this template -->
	<!-- <link href="/scripts/bootstrap/css/navbar-top-fixed.css" rel="stylesheet"> -->
	<script type="text/javascript" src="/scripts/jquery/jquery-3.7.0.min.js"></script>
	<script type="text/javascript" src="/scripts/jquery/ui/1.13.2/jquery-ui.min.js"></script>

	<!--
<script type="text/javascript" src="http://www.chartjs.org/dist/2.7.1/Chart.bundle.js"></script>
<script type="text/javascript" src="http://www.chartjs.org/samples/latest/utils.js"></script>
-->
	<!-- JS: Moment; used by: ChartJs, DateRangePicker -->
	<script type="text/javascript" src="/scripts/moment/moment.js"></script>

	<!-- JS: Chart JS -->
	<script type="text/javascript" src="/scripts/chartjs/Chart.bundle.js"></script>
	<script type="text/javascript" src="/scripts/chartjs/samples/utils.js"></script>
	<script type="text/javascript" src="/scripts/chartjs/plugins/chartjs-plugin-zoom.js"></script>
	<script type="text/javascript" src="/scripts/chartjs/plugins/chartjs-plugin-annotation.js"></script>
<!--<script type="text/javascript" src="/scripts/chartjs/plugins/chartjs-plugin-datalabels.js"></script>-->
<!--<script type="text/javascript" src="/scripts/chartjs/plugins/chartjs-plugin-colorschemes.js"></script>-->

	<!-- JS: DbxCentral -->
	<script type="text/javascript" src="/scripts/dbxcentral.utils.js"></script>
	<script type="text/javascript" src="/scripts/dbxcentral.graph.js"></script>

	<!-- JS: Bootstrap -->
	<!-- <link href="/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
	<script type="text/javascript" src="/scripts/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/scripts/popper/1.12.9/popper.min.js"></script>

	<!-- JS: DateRangePicker -->
	<script type="text/javascript" src="/scripts/bootstrap-daterangepicker/3.1/daterangepicker.js"></script>

	<!-- JS: Bootstrap - TABLE -->
	<script type="text/javascript" src="/scripts/bootstrap-table/1.12.1/bootstrap-table.js"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/editable/bootstrap-table-editable.js"></script> -->
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/export/bootstrap-table-export.js"></script> -->
	<!-- <script src="https://rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.js"></script> -->
	<script type="text/javascript" src="/scripts/bootstrap-table/1.12.1/extensions/filter-control/bootstrap-table-filter-control.js"></script>

	<!-- JS: jquery - contextMenu -->
	<script type="text/javascript" src="/scripts/jquery-contextmenu/2.9.2/jquery.contextMenu.min.js"></script>

	<!-- Prism: SQL Text Area needs this -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js'></script>

	<!-- SQL Server Showplan: html-query-plan -->
	<script src="https://cdn.jsdelivr.net/npm/html-query-plan@2.6.1/dist/qp.min.js"></script>
	<!-- The CSS is done at the TOP, since we override some stuff -->
	<!--<link href="https://cdn.jsdelivr.net/npm/html-query-plan@2.6.1/css/qp.min.css" rel="stylesheet">-->

	<!-- SQL formatter -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sql-formatter/12.1.3/sql-formatter.min.js" integrity="sha512-KYBOFOOIIdyOZnOWTuAIISlg049+bMVJfG5ZOi+ZIY+uqlFBErw0Nju4yIIEOiFkULPtn34VOi7u17Q6kBgtfg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<!-- JQuery Sparklines -->
	<!--<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js'></script> -->

	<!-- Postgres Query Plan -- PEV2 -->
	<script src="https://unpkg.com/vue@3.2.45/dist/vue.global.prod.js"></script>
	<script src="https://unpkg.com/pev2/dist/pev2.umd.js"></script>


	<!--
	  =======================================================================
	  == CSS imports - STYLES SHEETS GOES HERE
	  =======================================================================
	-->
	<!-- CSS: jqueri-ui -->
	<link rel="stylesheet" href="/scripts/jquery/ui/1.13.2/themes/smoothness/jquery-ui.css">

	<!-- CSS: DbxCentral -->
	<link rel="stylesheet" href="/scripts/css/dbxcentral.css">

	<!-- CSS: iota - layout -->
	<link rel="stylesheet" href="/scripts/css/iota.css" type="text/css">

	<!-- CSS: Bootstrap -->
	<link rel="stylesheet" href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css">  <!--  <<<< NOTE: This needs to go **BEFORE** bootstrap 4 css >>> -->
	<link rel="stylesheet" href="/scripts/bootstrap/css/bootstrap.min.css">

	<!-- CSS: DateRangePicker -->
	<link rel="stylesheet" href="/scripts/bootstrap-daterangepicker/3.1/daterangepicker.css">

	<!-- CSS: Font Awsome -->
	<link rel="stylesheet" href="/scripts/font-awesome/4.4.0/css/font-awesome.min.css">

	<!-- CSS: W2UI -->
	<!-- <link rel="stylesheet" href="scripts/w2ui/w2ui-1.5.rc1.css" type="text/css"> -->
	<!-- <script src="scripts/w2ui/w2ui-1.5.rc1.js" type="text/javascript"></script> -->

	<!-- JS: Bootstrap - TABLE -->
	<link rel="stylesheet" href="/scripts/bootstrap-table/1.12.1/bootstrap-table.min.css">
	<!-- <link rel="stylesheet" href="https://rawgit.com/vitalets/x-editable/master/dist/bootstrap3-editable/css/bootstrap-editable.css"> -->

	<!-- JS: jquery - contextMenu -->
	<link rel="stylesheet" href="/scripts/jquery-contextmenu/2.9.2/jquery.contextMenu.min.css">

	<!-- Prism: SQL Text Area needs this -->
	<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">-->
	<!--The above at top since we override some of the stuff */

	<!-- Postgres Query Plan -- PEV2 -->
<!--	<link rel="stylesheet" href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css">-->
	<link rel="stylesheet" href="https://unpkg.com/pev2/dist/style.css">

</head>

<body>
	<!-- <div id="toolbar" style="padding: 4px; border: 1px solid #dfdfdf; border-radius: 3px"></div> -->
	<nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark mb-0">
		<a class="navbar-brand" href="/">DbxCentral</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarCollapse">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item">
					<a class="nav-link" href="/overview">Servers</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/admin/admin.html">Admin</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/desktop_app.html">Desktop App</a>
				</li>
			</ul>

			<div    id="subscribe-feedback-msg"  class="dbx-nav-text"></div>
			<div    id="subscribe-feedback-srv"  class="dbx-nav-text"></div>
			<div    id="subscribe-feedback-time" class="dbx-nav-text mr-1"></div>

			<button id="dbx-refresh" class="fa fa-refresh btn btn-outline-light mx-2 my-0 my-sm-0" type="button" onclick="collectorRequestRefresh();" title="Send a 'Refresh Request' to the Collector(s)"></button>

			<div id="dbx-report-range" class="dbx-nav-text btn btn-outline-light mr-2">
				<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
				<span>Time Span</span> <b class="caret"></b>
			</div>

<!--
			<div id="dbx-report-range"
				<input type="text" class="form-control dbx-nav-text mr-2">
				<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
				<span>Time Span</span> <b class="caret"></b>
			</div>
 -->
			<!-- <div    id="dbx-start-time"          class="dbx-nav-text">2018-??-?? ??:??</div> -->
			<div class="btn px-0 btn-outline-light">
				<button id="dbx-prev-day"            title="Previous DAY, same time span"    alt="Previous DAY, samt time span"    class="dbx-nav-button p-0 ml-1" type="button"><i class="glyphicon fa fa-backward"></i></button>          <!-- fa-backward fa-fast-backward          -->
				<button id="dbx-prev-time"           title="Previous # Hours"                alt="Previous # Hours"                class="dbx-nav-button p-0"      type="button"><i class="glyphicon fa fa-arrow-circle-left"></i></button> <!-- fa-step-backward fa-arrow-circle-left -->
				<span   id="dbx-sample-time"         title="Hours in the selected Time Span" alt="Hours in the selected Time Span" class="">?h</span>
				<button id="dbx-next-time"           title="Next # Hours"                    alt="Next # Hours"                    class="dbx-nav-button p-0"      type="button"><i class="glyphicon fa fa-arrow-circle-right"></i></button> <!-- fa-step-forward fa-arrow-circle-right -->
				<button id="dbx-next-day"            title="Next DAY, same time span"        alt="Next DAY, samt time span"        class="dbx-nav-button p-0 mr-1" type="button"><i class="glyphicon fa fa-forward"></i></button>            <!-- fa-forward fa-fast-forward            -->
			</div>
			<button id="dbx-history-on"          class="fa fa-history    btn btn-outline-light mx-2 my-0 my-sm-0" type="button" title="Switch to 'History View' mode. (view older active SQL Statements)... This can also be done by clicking on any line at a Chart/Graph."> </button>
			<button id="dbx-history-off"         class="fa fa-line-chart btn btn-outline-light mx-2 my-0 my-sm-0" type="button" title="Switch to 'Normal View' mode... (Get out of History View mode)" style="display: none;"></button>

			<button id="dbx-filter"              class="fa fa-search btn btn-outline-light mx-0 my-0 my-sm-0" type="button" title="Open Search/Filter Dialog, to find any specififc Graph/Chart"></button>
<!--
			<button id="dbx-filter"              class="fa fa-search btn btn-outline-light mx-2 my-0 my-sm-0" type="button" title="Open Search/Filter Dialog, to find any specififc Graph/Chart"></button>
-->
		</div>
	</nav>

	<div class="dbx-content-container">

		<!-- Below navbar place a sticky div -->
		<div class="dbx-panel-below-navbar">
			<div id="progressDiv" class="progress">
				<div id="progressBar" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0"
					aria-valuemax="100" style="width:0%; min-width:25px">
					0%
				</div>
			</div>

			<!--<div id="api-feedback"></div>-->
			<div id="dbx-feedback">
				<table style='border-spacing: 0; width: 100%'>
					<tr>
						<td nowrap id='api-feedback'></td>
						<td nowrap style="width: 100%"></td>
						<td nowrap id='subscribe-feedback-msgXXX'></td>
						<td nowrap id='subscribe-feedback-timeXXX'></td>
					</tr>
				</table>
			</div>

			<div id="dbx-history-container-div" class="dbx-history-container-class" style="display: none;">
<!--
				<div style="width: 100%; display:flex; flex-flow:row wrap;">
					<p style="width: 1%; text-align: left;">     <button id="dbx-history-prev-entry"  title="Previous Active Statement"    alt="Previous Active Statement"    class="dbx-nav-button p-0 ml-1" type="button"><i class="glyphicon fa fa-backward"></i></button> </p>
					<p style="width: 98%; text-align: center;">   <input type="range" id="dbx-history-timeline-slider" min="0" max="100" step="1" value="50" class="dbx-history-timeline-slider-class"> </p>
					<p style="width: 1%; text-align: right;">    <button id="dbx-history-next-entry"  title="Next Active Statement"        alt="Next Active Statement"        class="dbx-nav-button p-0 mr-1" type="button"><i class="glyphicon fa fa-forward"></i></button> </p>
				</div>
-->
				<input type="range" id="dbx-history-timeline-slider" min="0" max="100" step="1" value="50" class="dbx-history-timeline-slider-class">

				<div id="dbx-history-slider-text-div" style="width: 100%; display:flex; flex-flow:row wrap;">
					<p id="dbx-history-slider-left-text"   style="font-size: 12px; color: #d3d3d3; width: 33%; text-align: left;"  >most-left-entry</p>
					<p id="dbx-history-slider-center-text" style="font-size: 12px; color: #d3d3d3; width: 33%; text-align: center;"></p>
					<p id="dbx-history-slider-right-text"  style="font-size: 12px; color: #d3d3d3; width: 33%; text-align: right;" >most-right-entry</p>
				</div>
<!--
				<button id="dbx-history-prev-entry"  title="Previous Active Statement"    alt="Previous Active Statement"    class="dbx-nav-button p-0 ml-1" type="button" onclick="dbxHistoryPrevActiveStatement()">  <i class="glyphicon fa fa-backward"></i>  </button>
				<button id="dbx-history-next-entry"  title="Next Active Statement"        alt="Next Active Statement"        class="dbx-nav-button p-0 mr-1" type="button" onclick="dbxHistoryNextActiveStatement()">  <i class="glyphicon fa fa-forward"></i>   </button>
-->
			</div>

		</div>

		<!-- Herer goes all charts/graphs -->
		<!-- Set the style later on in javascript -->
		<div id="graphs" class="grid" ></div>

		<!-- end-of-page: just add some extra space so we can scroll up a bit (in case there are alarms at the bottom) -->
		<div id="end-of-page">
			<br>
			<!--end-of-graphs-and-page<br>-->
			<!-- Just add some blank lines for scrolling purposes -->
			<br><br><br><br><br><br><br><br><br><br><br><br>
			<br><br><br><br><br><br><br><br><br><br><br><br>
			<br><br><br><br><br><br><br><br><br><br><br><br>
			<br><br><br><br><br><br><br><br><br><br><br><br>
		</div>
	</div> <!-- end dbx-content-container -->


	<div id="dbx-history-label-top" style="visibility: hidden;">
	History View
	</div>

	<!-- Spinner when loading history data from PCS -->
	<div id="dbx-history-get-data-bussy" style="visibility: hidden;"></div>



	<!-- Show Active SQL Statements -->
	<button id="active-statements-btn" class="active-statements-btn-class" onclick="openActiveStatementsWindow();">&lt;/&gt;</button>
<!--	<button id="active-statements-btn" class="active-statements-btn-class" onclick="openActiveStatementsWindow()">&lt;<span id="active-statements-btn-cnt" class="badge badge-pill badge-warning">/</span>&gt;</button>-->

	<div id="active-statements-top" style="display: none;">
	Active SQL Statements (not used for the moment)
	</div>

	<div id="active-statements" class="active-statements-class" style="display: none;">
		<div id="active-statements-ctl" class="active-statements-ctl-class">
			<span id="active-statements-count" style="color:black; font-weight: bold;">##</span> Active Statements...

			<span id="active-statements-win-size">
				Window Max Size:
<!--				<input type="radio" name="active-statements-show-radio" id="active-statements-show-radio-10" onclick="activeStatementsRadioClick(this);" value="10%"        > 10%-->
				<input type="radio" name="active-statements-show-radio" id="active-statements-show-radio-30" onclick="activeStatementsRadioClick(this);" value="30%" checked> 30%
				<input type="radio" name="active-statements-show-radio" id="active-statements-show-radio-60" onclick="activeStatementsRadioClick(this);" value="60%"        > 60%
				<input type="radio" name="active-statements-show-radio" id="active-statements-show-radio-85" onclick="activeStatementsRadioClick(this);" value="85%"        > 85%
<!--				<input type="radio" name="active-statements-show-radio" id="active-statements-show-radio-0"  onclick="activeStatementsRadioClick(this);" value="hide"       > Minimize-->
			</span>

			<span id="active-statements-counter-type">
				Counter Type:
				<input type="radio" name="active-statements-counter-type" id="active-statements-counter-type-abs"  onclick="activeStatementsCounterTypeClick(this);" value="abs"         > Abs
				<input type="radio" name="active-statements-counter-type" id="active-statements-counter-type-diff" onclick="activeStatementsCounterTypeClick(this);" value="diff"        > <font color="blue">Diff</font>
				<input type="radio" name="active-statements-counter-type" id="active-statements-counter-type-rate" onclick="activeStatementsCounterTypeClick(this);" value="rate" checked> <font color="blue">Rate</font>
			</span>

			<span id="active-statements-options">
				Options: &nbsp;
<!-- 				Min Exec Time
				<input type="text"     name="active-statements-execTime-txt"    id="active-statements-execTime-txt"    onchange="activeStatementsExecTimeClick(this);"   title='Only show Statements that has been executing for more than #### milliseconds'  value="-1" style="height:20px;width:50px" size="6"> &nbsp;&nbsp;
-->
				<input type="checkbox" name="active-statements-paused-chk"      id="active-statements-paused-chk"      onclick="activeStatementsPausedChkClick(this);"   title="Pause refresh of Active Statement (so you can read without beeing interupted)" value="paused"> Pause &nbsp;&nbsp;
				<input type="checkbox" name="active-statements-auto-open-chk"   id="active-statements-auto-open-chk"   onclick="activeStatementsAutoOpenChkClick(this);" title="Auto: Open=Has Active Statements, Close=NO Active Statement"                   value="auto-open"   checked> Auto Open &nbsp;&nbsp;
				<input type="checkbox" name="active-statements-solid-chk"       id="active-statements-solid-chk"       onclick="activeStatementsSolidChkClick(this);"    title="Use Solid background color"                                                    value="solid"       checked> Solid Background &nbsp;&nbsp;
				<input type="checkbox" name="active-statements-compExtDesc-chk" id="active-statements-compExtDesc-chk" onclick="activeStatementsCompExtDescClick(this);" title="Show Extended Descriptions Columns as HTML Formated or as 'Plain Text'"        value="compExtDesc" checked> Extended Descriptions as Plain Text
			</span>
		</div>
		<div id="active-statements-watermark"></div>
		<div id="active-statements-win" class="active-statements-win-class"></div>
	</div>


	<!-- Show Active alarms -->
	<div id="active-alarms-top" style="visibility: hidden;">
	Active Alarms
	</div>

	<div id="active-alarms" class="active-alarms-class" style="visibility: hidden;">
		<div id="active-alarms-ctl" class="active-alarms-ctl-class">
			There are <span id="active-alarms-count" style="color:red">##</span> Active Alarms...&nbsp;&nbsp;&nbsp; Window Max Size:
			<input type="radio" name="active-alarms-show-radio" id="active-alarms-show-radio-0"  onclick="activeAlarmsRadioClick(this);" value="hide"       > Minimize
			<input type="radio" name="active-alarms-show-radio" id="active-alarms-show-radio-10" onclick="activeAlarmsRadioClick(this);" value="10%"        > 10%
			<input type="radio" name="active-alarms-show-radio" id="active-alarms-show-radio-30" onclick="activeAlarmsRadioClick(this);" value="30%" checked> 30%
			<input type="radio" name="active-alarms-show-radio" id="active-alarms-show-radio-60" onclick="activeAlarmsRadioClick(this);" value="60%"        > 60%
			<input type="radio" name="active-alarms-show-radio" id="active-alarms-show-radio-95" onclick="activeAlarmsRadioClick(this);" value="95%"        > 95% &nbsp;&nbsp;&nbsp;
			<input type="checkbox" name="active-alarms-solid-chk" id="active-alarms-solid-chk"   onclick="activeAlarmsChkClick(this);"   value="solid"> Solid Background &nbsp;&nbsp;&nbsp;
			<input type="checkbox" name="active-alarms-compExtDesc-chk" id="active-alarms-compExtDesc-chk"   onclick="activeAlarmsCompExtDescClick(this);" title="Show Extended Descriptions Columns as HTML Formated or as 'Plain Text'"  value="compExtDesc" checked> Extended Descriptions as Plain Text
		</div>
		<div id="active-alarms-win" class="active-alarms-win-class">
		</div>
	</div>



    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: Filter dialog -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<div class="modal fade" id="dbx-filter-dialog" tabindex="-1" role="dialog" aria-labelledby="dbx-filter-dialog" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
			<h5 class="modal-title" id="dbx-filter-dialog-title">Locate or Set Visibility for specific Graph(s)</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
			</div>
			<div class="modal-body">
				<ul>
					<li>Click on the 'GoTo' icon <span class="glyphicon fa fa-arrow-circle-right"></span> to Locate or set Fucus on a Specific Graph</li>
					<li>Set what Graph(s) you want to be visible, using the Checkbox and press the 'Set Visibility' button.</li>
				</ul>
				<table id="dbx-graph-filter-table"
					class="table-responsive"
					data-show-columns="false"
					data-paging="false"
					data-filtering="true"
					data-filter-control="true"
					data-click-to-select="false"
					data-sorting="true"
					data-checkbox-header="true"
					data-maintain-selected="true"
					data-ignore-click-to-select-on=scrollToDisableCheckRow()>
					<thead>
						<tr>
							<th data-field="visible"   data-checkbox="true"></th>
							<th data-field="scrollTo"  data-formatter="scrollToFormatter" data-sortable="false"></th>
							<th data-field="desc"      data-filter-control="input"  data-sortable="true">Description</th>
							<th data-field="type"      data-filter-control="select" data-sortable="true">Type</th>
							<th data-field="cm"        data-filter-control="input"  data-sortable="true">Counter Model</th>
							<!-- <th data-field="graphName" data-filter-control="input"  data-sortable="true">Graph Name</th> -->
							<!-- <th data-field="fullName"  data-filter-control="input"  data-sortable="true">Full Graph Name</th> -->
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="bs-checkbox "><input data-index="0" name="btSelectItem" type="checkbox"></td>
							<td>dummy-1</td>
							<td>dummy-2</td>
							<td>dummy-3</td>
							<td>dummy-4</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
			<button type="button" class="btn btn-primary" data-dismiss="modal" id="dbx-filter-dialog-ok">Set Visibility</button>
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
		</div>
	</div>
<!-- -->


  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   - - Modal Dialog: Extended Description   dbx-view-extDescTable-dialog
   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View LockTable dialog -->
	<div class='modal fade' id='dbx-view-extDescTable-dialog' role='dialog' aria-labelledby='dbx-view-extDescTable-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-extDescTable-dialog-title'><b><span id='dbx-view-extDescTable-label'></span></b> <span id='dbx-view-extDescTable-objectName'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree' style='width: 3000px;'>
<!--						<pre><code id='dbx-view-extDescTable-content' class='language-sql line-numbers dbx-view-extDescTable-content' ></code></pre>-->
						<div id='dbx-view-extDescTable-content' class='dbx-view-extDescTable-content'></div>
					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>
	function createExtDescTableToolTipDiv(data, label)
	{
		const dataVal = data;

		const div = document.createElement("div");
		div.innerHTML = "&nbsp;";
		div.setAttribute("title"           , "Click to Open Dialog... \n-------------------------------");// \n" + dataVal);
		div.setAttribute("data-toggle"     , 'modal');
		div.setAttribute("data-target"     , '#dbx-view-extDescTable-dialog');
		div.setAttribute("data-objectname" , '');
		div.setAttribute("data-tooltip"    , dataVal);
		div.setAttribute("data-label"      , label);

		return div;
	}
	$('#dbx-view-extDescTable-dialog').on('show.bs.modal', function(e) {
		var data = $(e.relatedTarget).data();

		console.log('#dbx-view-extDescTable-dialog: data: '+data, data);

		$('#dbx-view-extDescTable-objectName', this).text(data.objectname);
		$('#dbx-view-extDescTable-content',    this).html(data.tooltip);
		$('#dbx-view-extDescTable-label',      this).html(data.label);

		// Scroll top top (do not seems to work)
		$('#dbx-view-extDescTable-dialog').animate({ scrollTop: 0 }, 'slow');
	});
	</script>

  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   - - Modal Dialog: Alarm Info   dbx-view-alarmView-dialog
   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View LockTable dialog -->
	<div class='modal fade' id='dbx-view-alarmView-dialog' role='dialog' aria-labelledby='dbx-view-alarmView-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-alarmView-dialog-title'><b><span id='dbx-view-alarmView-label'></span></b> <span id='dbx-view-alarmView-objectName'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree' style='width: 3000px;'>
<!--						<pre><code id='dbx-view-alarmView-content' class='language-sql line-numbers dbx-view-alarmView-content' ></code></pre>-->
						<div id='dbx-view-alarmView-content' class='dbx-view-alarmView-content'></div>
					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>
	function createAlarmInfoToolTipDiv(data, label)
	{
		const dataVal = data;

		const div = document.createElement("div");
		div.innerHTML = "&nbsp;";
		div.setAttribute("title"           , "Click to Open Dialog... \n-------------------------------");// \n" + dataVal);
		div.setAttribute("data-toggle"     , 'modal');
		div.setAttribute("data-target"     , '#dbx-view-alarmView-dialog');
		div.setAttribute("data-objectname" , '');
		div.setAttribute("data-tooltip"    , dataVal);
		div.setAttribute("data-label"      , label);

		return div;
	}
	$('#dbx-view-alarmView-dialog').on('show.bs.modal', function(e) {
		var data = $(e.relatedTarget).data();

		$('#dbx-view-alarmView-objectName', this).text(data.objectname);
		$('#dbx-view-alarmView-content',    this).html("Formatting the Alarm Message...");
		$('#dbx-view-alarmView-label',      this).html(data.label);

//		console.log('#dbx-view-alarmView-dialog: data: '+data, data);
//		console.log('#dbx-view-alarmView-dialog: data.tooltip: '+data, data.tooltip);
//		console.log('#dbx-view-alarmView-dialog: JSON.stringify(data.tooltip): ' + JSON.stringify(data.tooltip));

		// In here we do a REST:POST call to /api/alarm/formatter
		// to format the Alarm info in the same way as we format alarm-emails
//		fetch("/api/alarm/formatter",
//		{
//			method: 'POST',
//			headers: {
//				'Accept': 'application/json',
//				'Content-Type': 'application/json'
//			},
//			body: JSON.stringify(data.tooltip)
//		})
//		.then(responceData =>
//		{
//			const responceText = responceData.text();
//			console.log("AlarmFormatter RESPONCE-TEXT: " + responceText, responceText);
//			$('#dbx-view-alarmView-content', this).html(responceText);
//		})
//		.catch(error =>
//		{
//			$('#dbx-view-alarmView-content', this).html(error);
//		});
		$.ajax(
		{
			url: "/api/alarm/formatter",
			type: 'post',
			// async: false,   // to call it one by one (async: true = spawn away a bunch of them in the background)
			data: JSON.stringify(data.tooltip),
			contentType: "application/json; charset=utf-8",
//			dataType: "json",

			success: function(data, status)
			{
//				console.log("Format Alarm Message - RECEIVED DATA: " + data);
				$('#dbx-view-alarmView-content').html(data);
			},
			error: function(xhr, desc, err)
			{
				console.log(xhr);
				console.log("ERROR - Details: " + desc + "\nError: " + err);
//				$('#dbx-view-alarmView-content').html("Details: " + desc + "<br>Error: " + err);
				$('#dbx-view-alarmView-content').html(xhr.responseText);
			}
		}); // end: ajax call

		// Scroll top top (do not seems to work)
		$('#dbx-view-alarmView-dialog').animate({ scrollTop: 0 }, 'slow');
	});
	</script>


    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View SqlText dialog -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<div class='modal fade' id='dbx-view-sqltext-dialog' role='dialog' aria-labelledby='dbx-view-sqltext-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-sqltext-dialog-title'><b>Text Type:</b> <span id='dbx-view-sqltext-objectName'></span> <span id='dbx-view-sqltext-sqlDialect'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree' style='width: 3000px;'>
						<pre><code id='dbx-view-sqltext-content' class='language-sql line-numbers dbx-view-sqltext-content' ></code></pre>
					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-outline-secondary' onclick="sqlTextDialogFormatSQL();">Format SQL Text</button>
					<button type='button' class='btn btn-outline-secondary' onclick="sqlTextDialogCopySql();">Copy SQL Text</button>
					&emsp;&emsp;&emsp;&emsp;&emsp;
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>
		function sqlTextDialogCopySql()
		{
			let sqlText = $("#dbx-view-sqltext-content").text();

			const textArea = document.createElement("textarea");
			textArea.value = sqlText;
			document.body.appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				alert('Unable to copy to clipboard\n\n' + err);
			}
			document.body.removeChild(textArea);
		}
		function sqlTextDialogFormatSQL()
		{
			let sqlDialect = $("#dbx-view-sqltext-sqlDialect").text();
			if (sqlDialect === "")
				sqlDialect = "tsql";

			let formatOptions = {
				language: sqlDialect,
				tabWidth: 4,
				keywordCase: 'upper',
				tabulateAlias: true
			};

			let sqlText = $("#dbx-view-sqltext-content").text();

			// Remove first ')' if it start with that... It's a issue when getting the SQL Text in SqlServerTune which I should FIX
			if (sqlText.startsWith(')'))
				sqlText = sqlText.substr(1);

			// DYNAMIC_SQL dyn198: create proc dyn198 as SELECT f.xid AS foretagId...
			if (sqlText.startsWith('DYNAMIC_SQL ')) // ASE has the folowing prefix sometimes
			{
				let startPos = sqlText.indexOf(':');
				if (startPos >= 0)
					sqlText = sqlText.substr(startPos + 1);
			}

			console.log("Format SQL with options: " + formatOptions, formatOptions);

			// NOTE 'sqlFormatter' do not do a good job at T-SQL like variables etc...
			// SO Possibly use https://www.npmjs.com/package/poor-mans-t-sql-formatter   ... but I couldn't find a CDN to load it from
		 	try {
				let formattedSqlText = sqlFormatter.format( sqlText, formatOptions );
				$("#dbx-view-sqltext-content").text(formattedSqlText);
				Prism.highlightAll();
			} catch (error) {
				alert(error);
			}
		}
	</script>


    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View LockTable dialog -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<div class='modal fade' id='dbx-view-lockTable-dialog' role='dialog' aria-labelledby='dbx-view-lockTable-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-lockTable-dialog-title'><b>Lock Table:</b> <span id='dbx-view-lockTable-objectName'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree' style='width: 3000px;'>
<!--						<pre><code id='dbx-view-lockTable-content' class='language-sql line-numbers dbx-view-lockTable-content' ></code></pre>-->
						<div id='dbx-view-lockTable-content' class='dbx-view-lockTable-content'></div>
					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>


    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View Postgres Execution Plan dialog -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<div class='modal fade' id='dbx-view-pgShowplan-dialog' role='dialog' aria-labelledby='dbx-view-pgShowplan-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content' style='height: 80vh;'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-pgShowplan-dialog-title'><b>Postgres Execution Plan:</b> <span id='dbx-view-pgShowplan-objectName'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree'>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-pgShowplan-content").toggle();'>Hide/Show Below Execution Plan</button>
						<br>
						<div id='dbx-view-pgShowplan-content' class='dbx-view-pgShowplan-content'> 
							<!-- The below tag is injected when creating the vue object -->
							<!-- AT: $('#dbx-view-pgShowplan-dialog').on('shown.bs.modal'...-->
							<!-- <pev2 style='min-height: 50vh;' :plan-source="plan" :plan-query="query" /> -->
						</div>
						<br>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-pgShowplan-sqlContent").toggle();'>Hide/Show Below SQL Text</button>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick="pgShowplanFormatSql();">Format Below SQL Text</button>
						<pre><code id='dbx-view-pgShowplan-sqlContent' class='language-sql line-numbers dbx-view-sqltext-content' ></code></pre>

						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-pgShowplan-planContent").toggle();'>Hide/Show Below Plan Text</button>
						<pre><code id='dbx-view-pgShowplan-planContent' class='language-json line-numbers dbx-view-sqltext-content' ></code></pre>

					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-outline-secondary' onclick="pgShowplanCopySql();">Copy SQL Text</button>
					<button type='button' class='btn btn-outline-secondary' onclick="pgShowplanCopyPlan();">Copy Plan Text</button>
					<button type='button' class='btn btn-outline-secondary' onclick="pgShowplanSaveToFile();">Save Plan File</button>
					<button type='button' class='btn btn-outline-secondary' onclick="pgShowplanOpenExternal();">Open Plan in External Window</button>
					&emsp;&emsp;&emsp;&emsp;&emsp;
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>

		// Variable to hold the PEV2 Vue Component (so that we can unmount/destroy it when the Modal is CLOSED
		var pev2app;

		//---------------------------------------------------------------------------
		// BEFORE the modal is visible, set some properties...
		$('#dbx-view-pgShowplan-dialog').on('show.bs.modal', function(e) {
			var data = $(e.relatedTarget).data();

//			console.log('#dbx-view-pgShowplan-dialog: data: '+data, data);

			$('#dbx-view-pgShowplan-objectName' , this).text(data.objectname);
			$('#dbx-view-pgShowplan-planContent', this).text(data.tooltip);
//			$('#dbx-view-pgShowplan-sqlContent' , this).text(pgShowplanGetSql(data.tooltip));
			pgShowplanGetSql(data.tooltip, true);
		});

		//---------------------------------------------------------------------------
		// AFTER the modal is visible, CREATE the PEV2 Vue Component that will show the Postgres Execution Plan
		// If we do it at 'show.bs.modal' the component will not show/work to 100%
		$('#dbx-view-pgShowplan-dialog').on('shown.bs.modal', function(e) {
			var data = $(e.relatedTarget).data();

			// Add/Inject the "html tag" that IS the Vue component
			// This is done here; Because when we do pev2app.unmount() in: $('#dbx-view-pgShowplan-dialog').on('hidden.bs.modal'...
			// The DOM is also removed (content under "dbx-view-pgShowplan-content" seems to be removed by: unmount()
			const dbxViewPgShowplanContent = document.getElementById("dbx-view-pgShowplan-content");
			dbxViewPgShowplanContent.innerHTML = "<pev2 style='min-height: 55vh;' :plan-source='plan' :plan-query='query' />";
			
			const { createApp } = Vue;
			pev2app = createApp({
				data() {
					return {
						plan: data.tooltip,
//						query: "-- Sorry, SQL Text was not provided!" // This will be overridden if the Plan holds any SQL Text...
						query: ""
					}
				},
				created() {
//					console.log("component.created() QUERY: " + this.$data.query, this.$data.query);
//					console.log("component.created() XXXXX: " + pev2.Plan.queryText.value);
				}
			});
			pev2app.component("pev2", pev2.Plan);
			pev2app.mount("#dbx-view-pgShowplan-content");

			// highlight again, since the dialog DOM wasn't visible earlier
			Prism.highlightAll();

			// Scroll top top (do not seems to work)
			$('#dbx-view-pgShowplan-dialog').animate({ scrollTop: 0 }, 'slow');
		});
		
		//---------------------------------------------------------------------------
		// AFTER the modal is CLOSED, Destroy the PEV2 Vue Component that was showing the Postgres Execution Plan
		$('#dbx-view-pgShowplan-dialog').on('hidden.bs.modal', function(e) {
			//console.log("#dbx-view-pgShowplan-dialog <<<<<<<<<<<<<<<<<<<< hidden.");
			pev2app.unmount();
			pev2app = undefined;
		});

		//---------------------------------------------------------------------------
		function pgShowplanGetSql(planText, setFields)
		{
			//duration: 4001.386 ms  plan:
			//Query Text: select pg_sleep(4)
			//
			//Result  (cost=0.00..0.03 rows=1 width=4) (actual time=4001.370..4001.372 rows=1 loops=1)
			//Output: pg_sleep('4'::double precision)
			//Settings: work_mem = '16MB', effective_io_concurrency = '200', random_page_cost = '1.1', cpu_tuple_cost = '0.03'
			//Query Identifier: -3416356442043621232

			let sqlText = undefined;
			let queryId = undefined;

			planText = planText.trim();

			// Remove: duration: 4001.386 ms  plan:
			planText = planText.replace(/^duration: .* ms\s+plan:$/m, "").trim();

			// Try with JSON
			try {
				const json = JSON.parse(planText);
				if (json.hasOwnProperty('Query Text'))        sqlText = json['Query Text'];
				if (json.hasOwnProperty('Query Identifier'))  queryId = json['Query Identifier'];
			} catch (error) {
				//console.log("pgShowplanGetSql(): Parse JSON error=|" + error + "|.", error);
				// continue
			}

			// Fallback on 
			if (sqlText === undefined)
			{
				if (/^Query Text: /.test(planText))
				{
					planText = planText.replace(/^Query Text: /, "").trim();
					// first "empty newline"
					let endPos = planText.search(/^$/m);
					sqlText = planText.substring(0, endPos).trim();
				}

				// Get "Query Identifier"
				let startPos = planText.search(/Query Identifier: /m);
				if (startPos !== -1)
					queryId = planText.substring(startPos + "Query Identifier: ".length).trim();
			}

			if (sqlText === undefined)
				sqlText = "-- No 'Query Text' was found in the plan. The SQL Text *may* be available in the above Plan, under 'Query' tab.";

			if (setFields !== undefined && setFields)
			{
				$('#dbx-view-pgShowplan-sqlContent').text(sqlText);

				if (queryId === undefined)
					$('#dbx-view-pgShowplan-objectName').text("--Unknown Query Identifier--");
				else
					$('#dbx-view-pgShowplan-objectName').text(queryId);
			}

			return sqlText;
		}
		//---------------------------------------------------------------------------
		function pgShowplanFormatSql()
		{
			let formatOptions = {
				language: 'postgresql',
				tabWidth: 4,
				keywordCase: 'upper',
				tabulateAlias: true
			};

			let sqlText = $("#dbx-view-pgShowplan-sqlContent").text();

		 	try {
				let formattedSqlText = sqlFormatter.format( sqlText, formatOptions );
				$("#dbx-view-pgShowplan-sqlContent").text(formattedSqlText);
				Prism.highlightAll();
			} catch (error) {
				alert(error);
			}
		}
		//---------------------------------------------------------------------------
		function submit_post_via_hidden_form(url, params) {
			var hiddenForm = $("<form target='_blank' method='POST' style='display:none;'></form>").attr({
				action: url
			}).appendTo(document.body);

			for (var i in params) {
				if (params.hasOwnProperty(i)) {
					$('<input type="hidden" />').attr({
						name: i,
						value: params[i]
					}).appendTo(hiddenForm);
				}
			}

			hiddenForm.submit();
			hiddenForm.remove();
		}
		//---------------------------------------------------------------------------
		function pgShowplanOpenExternal()
		{
			let planText = $("#dbx-view-pgShowplan-planContent").text();
			let currentLocation = window.location.toString();

			// If we are NOT served by a WebServer we might want to "direct" this "somewhere else"
			let toUrl = '/showplan/postgres';
			if ( ! currentLocation.toLowerCase().startsWith("http") )
				toUrl = "http://dbxtune.gorans.org" + toUrl;

			//console.log("currentLocation=|" + currentLocation + "|, toUrl=|" + toUrl + "|");
			submit_post_via_hidden_form(toUrl,
			{
				plan: planText
			});
		}
		//------------------------------------------------------------------------------------------
		function pgShowplanSaveToFile()
		{
			let pgShowplanXmlText = $("#dbx-view-pgShowplan-planContent").text();
			let pgPlanName        = $("#dbx-view-pgShowplan-objectName").text();

			if (pgPlanName === "")
				pgPlanName = "name";

			const link = document.createElement("a");
			const file = new Blob([pgShowplanXmlText], { type: 'text/plain' });
			link.href = URL.createObjectURL(file);
			link.download = "pg_execution_plan_" + pgPlanName + ".pgplan";
			link.click();
			URL.revokeObjectURL(link.href);
		}
		//---------------------------------------------------------------------------
		function pgShowplanCopySql()
		{
			let txt = $("#dbx-view-pgShowplan-sqlContent").text();

//console.log("SQL-TEXT=|"+txt+"|");

			const textArea = document.createElement("textarea");
			textArea.value = txt;
			document.body.appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				alert('Unable to copy to clipboard\n\n' + err);
			}
			document.body.removeChild(textArea);
		}
		//---------------------------------------------------------------------------
		function pgShowplanCopyPlan()
		{
			let txt = $("#dbx-view-pgShowplan-planContent").text();

//console.log("PLAN-TEXT=|"+txt+"|");

			const textArea = document.createElement("textarea");
			textArea.value = txt;
			document.body.appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				alert('Unable to copy to clipboard\n\n' + err);
			}
			document.body.removeChild(textArea);
		}
	</script>



    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<!-- Modal: View SQL Server Showplan dialog -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<div class='modal fade' id='dbx-view-ssShowplan-dialog' role='dialog' aria-labelledby='dbx-view-ssShowplan-dialog' aria-hidden='true'>
		<div class='modal-dialog modal-dialog-centered mw-100 w-75' role='document'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h5 class='modal-title' id='dbx-view-ssShowplan-dialog-title'><b>SQL Server Showplan:</b> <span id='dbx-view-ssShowplan-objectName'></span></h5>
					<button type='button' class='close' data-dismiss='modal' aria-label='Close'>
						<span aria-hidden='true'>&times;</span>
					</button>
				</div>
				<div class='modal-body' style='overflow-x: auto;'>
					<div class='scroll-tree' style='width: 3000px;'>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-ssShowplan-content").toggle();'>Hide/Show Below Execution Plan</button>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='QP.drawLines(document.getElementById("dbx-view-ssShowplan-content"));'>Redraw Lines</button>
						<br><br>
						<div id='dbx-view-ssShowplan-content' class='dbx-view-ssShowplan-content'></div>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-ssShowplan-sqlContent").toggle();'>Hide/Show Below SQL Text</button>
						<button type='button' class='btn btn-outline-secondary btn-sm' onclick="ssShowplanFormatSql();">Format Below SQL Text</button>
						<pre><code id='dbx-view-ssShowplan-sqlContent' class='language-sql line-numbers dbx-view-sqltext-content' ></code></pre>

						<button type='button' id='dbx-view-ssShowplan-compileParameterValuesButton' class='btn btn-outline-secondary btn-sm' onclick="ssShowplanSetParametersInSql('compile');">Apply Compile Parameters to the Above SQL Text</button>
						<pre><code id='dbx-view-ssShowplan-compileParameterValues' class='language-sql line-numbers dbx-view-sqltext-content' ></code></pre>

						<button type='button' id='dbx-view-ssShowplan-runtimeParameterValuesButton' class='btn btn-outline-secondary btn-sm' onclick="ssShowplanSetParametersInSql('runtime');">Apply Runtime Parameters to the Above SQL Text</button>
						<pre><code id='dbx-view-ssShowplan-runtimeParameterValues' class='language-sql line-numbers dbx-view-sqltext-content' ></code></pre>

						<button type='button' class='btn btn-outline-secondary btn-sm' onclick='$("#dbx-view-ssShowplan-xmlContent").toggle();'>Hide/Show Below XML Text</button>
						<pre><code id='dbx-view-ssShowplan-xmlContent' class='language-xml line-numbers dbx-view-sqltext-content' ></code></pre>
					</div>
				</div>
				<div class='modal-footer'>
					<button type='button' class='btn btn-outline-secondary' onclick="ssShowplanCopySql();">Copy SQL Text</button>
					<button type='button' class='btn btn-outline-secondary' onclick="ssShowplanCopyXml();">Copy XML Text</button>
					<button type='button' class='btn btn-outline-secondary' onclick="ssShowplanSaveXmlToFile();">Save XML File</button>
					<button type='button' class='btn btn-outline-secondary' onclick="ssShowplanOpenExternal();">Open Plan in External Window</button>
					&emsp;&emsp;&emsp;&emsp;&emsp;
					<button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>
		//---------------------------------------------------------------------------
		// BEFORE the modal is visible, set some properties...
		$('#dbx-view-ssShowplan-dialog').on('show.bs.modal', function(e) {
			var data = $(e.relatedTarget).data();

//			console.log('#dbx-view-ssShowplan-dialog: data: '+data, data);

			$('#dbx-view-ssShowplan-objectName', this).text(data.objectname);
			//$('#dbx-view-ssShowplan-content',  this).text(data.tooltip);
			$('#dbx-view-ssShowplan-content',    this).text("Waiting for the plain to be loaded... Hold on for a few seconds.");
			$('#dbx-view-ssShowplan-xmlContent', this).text(formatXml(data.tooltip));
			$('#dbx-view-ssShowplan-sqlContent', this).text(ssShowplanGetSql());
			ssShowplanGetParameters(); // sets both Compile and Runtime parameters in there fields
		});

		//---------------------------------------------------------------------------
		// AFTER the modal is visible, CREATE the PEV2 Vue Component that will show the Postgres Execution Plan
		// If we do it at 'show.bs.modal' the component will not show/work to 100%
		$('#dbx-view-ssShowplan-dialog').on('shown.bs.modal', function(e) {
			var data = $(e.relatedTarget).data();

			console.log('#dbx-view-ssShowplan-dialog: AFTER-SHOW: data: '+data, data);

			// Create and DRAW the Showplan in a deferred mode, otherwise the "lines" between the nodes wont show up in the *correct location*
//			setTimeout(function() {
				QP.showPlan(document.getElementById("dbx-view-ssShowplan-content"), data.tooltip);
//			}, 500);

			// highlight again, since the dialog DOM wasn't visible earlier
			Prism.highlightAll();

			// Scroll top top (do not seems to work)
			$('#dbx-view-ssShowplan-dialog').animate({ scrollTop: 0 }, 'slow');

//			// If it takes a LONG time to load... the lines are NOT VISIBLE, so lets draw them again!
//			$('#dbx-view-ssShowplan-dialog').on('loaded.bs.modal', function(e) {
//				setTimeout(function() {
//					QP.drawLines(document.getElementById("dbx-view-ssShowplan-content"));
//				}, 500);
//			});
		});
			
		//------------------------------------------------------------------------------------------
		function ssShowplanFormatSql()
		{
			let formatOptions = {
				language: 'tsql',
				tabWidth: 4,
				keywordCase: 'upper',
				tabulateAlias: true
			};

			let sqlText = $("#dbx-view-ssShowplan-sqlContent").text();

		 	try {
				let formattedSqlText = sqlFormatter.format( sqlText, formatOptions );
				$("#dbx-view-ssShowplan-sqlContent").text(formattedSqlText);
				Prism.highlightAll();
			} catch (error) {
				alert(error);
			}
		}
		//---------------------------------------------------------------------------
		function ssShowplanOpenExternal()
		{
			let planText = $("#dbx-view-ssShowplan-xmlContent").text();
			let currentLocation = window.location.toString();

			// If we are NOT served by a WebServer we might want to "direct" this "somewhere else"
			let toUrl = '/showplan/sqlserver';
			if ( ! currentLocation.toLowerCase().startsWith("http") )
				toUrl = "http://dbxtune.gorans.org" + toUrl;

			//console.log("currentLocation=|" + currentLocation + "|, toUrl=|" + toUrl + "|");
			submit_post_via_hidden_form(toUrl,
			{
				plan: planText
			});
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanSaveXmlToFile()
		{
			let ssShowplanXmlText = $("#dbx-view-ssShowplan-xmlContent").text();
			let ssPlanName        = $("#dbx-view-ssShowplan-objectName").text();

			if (ssPlanName === "")
				ssPlanName = "name";
			else
				ssPlanName = "for_QueryPlanHash_" + ssPlanName;

			const link = document.createElement("a");
			const file = new Blob([ssShowplanXmlText], { type: 'text/plain' });
			link.href = URL.createObjectURL(file);
			link.download = "showplan_" + ssPlanName + ".xml.sqlplan";
			link.click();
			URL.revokeObjectURL(link.href);
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanCopyXml()
		{
			let ssShowplanXmlText = $("#dbx-view-ssShowplan-xmlContent").text();

			const textArea = document.createElement("textarea");
			textArea.value = ssShowplanXmlText;
			document.body.appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				alert('Unable to copy to clipboard\n\n' + err);
			}
			document.body.removeChild(textArea);
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanGetSql()
		{
			let ssShowplanXmlText = $("#dbx-view-ssShowplan-xmlContent").text();

			// In case of the below does NOT work, simply empty the SQL Text
			$('#dbx-view-ssShowplan-sqlContent').text("-- No SQL StatementText was found in the XML Plan.");


			let xmlDoc = $.parseXML(ssShowplanXmlText);
//			let sqlText = $(xmlDoc).find("StmtSimple").attr("StatementText");

			let sqlText          = "";
			let sqlTextArr       = [];
			let queryPlanHash    = "";
			let queryPlanHashArr = [];
			$(xmlDoc).find("StmtSimple").each(function(i,e) {
				sqlTextArr      .push($(e).attr("StatementText"));
				queryPlanHashArr.push($(e).attr("QueryPlanHash"));
			});

//			if (sqlTextArr.length === 0)
//				return "-- No SQL StatementText was found in the XML Plan.";

			if (sqlTextArr.length === 1)
				sqlText = sqlTextArr[0];
			else
			{
				for (let i=0; i<sqlTextArr.length; i++)
				{
					sqlText += "--===================================================\n";
					sqlText += "-- SQL Statement " + (i+1) + "   of " + sqlTextArr.length + "\n";
					sqlText += "-----------------------------------------------------\n";
					sqlText += sqlTextArr[i] + "\n";
					sqlText += "-- end ----------------------------------------------\n";
					sqlText += "\n";
				}
			}
			
			// Set the ObjectName...
			if (queryPlanHashArr.length > 0)
			{
				queryPlanHash = queryPlanHashArr[0];
				
				if ( $('#dbx-view-ssShowplan-objectName').text() === "" )
				{
					$('#dbx-view-ssShowplan-objectName').text("QueryPlanHash=" + queryPlanHash);
				}
			}
			
			return sqlText;
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanCopySql()
		{
//			let sqlText = ssShowplanGetSql();
			let sqlText = $("#dbx-view-ssShowplan-sqlContent").text();

console.log("SQLTEXT=|"+sqlText+"|");

			const textArea = document.createElement("textarea");
			textArea.value = sqlText;
			document.body.appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				alert('Unable to copy to clipboard\n\n' + err);
			}
			document.body.removeChild(textArea);
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanGetParameters()
		{
			let ssShowplanXmlText = $("#dbx-view-ssShowplan-xmlContent").text();

			let xmlDoc = $.parseXML(ssShowplanXmlText);

			// Below is how the XML Looks like
			//-----------------------------------------------------
			// <ParameterList>
			//     <ColumnReference Column="@2" ParameterDataType="varchar(8000)" ParameterCompiledValue="'2023-04-01 00:00:00'"/>
			//     <ColumnReference Column="@1" ParameterDataType="varchar(8000)" ParameterCompiledValue="'2023-03-01 00:00:00'"/>
			// </ParameterList>
			//-----------------------------------------------------
			// <ParameterList>
			//     <ColumnReference Column="@1" ParameterCompiledValue="'XXX'" ParameterDataType="varchar(8000)" ParameterRuntimeValue="'XXX'"/>
			// </ParameterList>
			//-----------------------------------------------------

			let compileParamsArr = [];
			let runtimeParamsArr = [];
			$(xmlDoc).find("ParameterList").find("ColumnReference").each(function(i,e)
			{
				if (e.hasAttribute("ParameterCompiledValue"))
				{
				//	let xxx = '<ColumnReference Column="' + e.getAttribute("Column") + '" ParameterCompiledValue="' + e.getAttribute("ParameterCompiledValue") + '" ParameterDataType="' + e.getAttribute("ParameterDataType") + '"/>';
					let xxx = 'CompiledValue: Parameter="' + e.getAttribute("Column") + '" Value="' + e.getAttribute("ParameterCompiledValue") + '" DataType="' + e.getAttribute("ParameterDataType") + '"';
					compileParamsArr.push(xxx);
				}
				if (e.hasAttribute("ParameterRuntimeValue"))
				{
				//	let xxx = '<ColumnReference Column="' + e.getAttribute("Column") + '" ParameterRuntimeValue="' + e.getAttribute("ParameterRuntimeValue") + '" ParameterDataType="' + e.getAttribute("ParameterDataType") + '"/>';
					let xxx = 'RuntimeValue: Parameter="' + e.getAttribute("Column") + '" Value="' + e.getAttribute("ParameterRuntimeValue") + '" DataType="' + e.getAttribute("ParameterDataType") + '"';
					runtimeParamsArr.push(xxx);
				}
			});
			// Reverse the arrays (since the XML holds it in the "wrong" order
			compileParamsArr = compileParamsArr.reverse();
			runtimeParamsArr = runtimeParamsArr.reverse();

			let compileParameterText = "";
			let runtimeParameterText = "";

			for (let i=0; i<compileParamsArr.length; i++)
				compileParameterText += compileParamsArr[i] + "\n";

			for (let i=0; i<runtimeParamsArr.length; i++)
				runtimeParameterText += runtimeParamsArr[i] + "\n";

			$('#dbx-view-ssShowplan-runtimeParameterValues').text(runtimeParameterText);

			if (compileParamsArr.length > 0)
			{
				$('#dbx-view-ssShowplan-compileParameterValues').text(compileParameterText);
				$('#dbx-view-ssShowplan-compileParameterValuesButton').show();
			}
			else
			{
				$('#dbx-view-ssShowplan-compileParameterValues').text("-- No Compile Parameters was found in the XML Plan.");
				$('#dbx-view-ssShowplan-compileParameterValuesButton').hide();
			}

			if (runtimeParamsArr.lenth > 0)
			{
				$('#dbx-view-ssShowplan-runtimeParameterValues').text(compileParameterText);
				$('#dbx-view-ssShowplan-runtimeParameterValuesButton').show();
			}
			else
			{
				$('#dbx-view-ssShowplan-runtimeParameterValues').text("-- No Runtime Parameters was found in the XML Plan.");
				$('#dbx-view-ssShowplan-runtimeParameterValuesButton').hide();
			}
		}
		//------------------------------------------------------------------------------------------
		function ssShowplanSetParametersInSql(paramType)
		{
//			alert("Sorry: Not yet implemented");

			let ssShowplanXmlText = $("#dbx-view-ssShowplan-xmlContent").text();

			let xmlDoc = $.parseXML(ssShowplanXmlText);

			$(xmlDoc).find("ParameterList").find("ColumnReference").each(function(i,e)
			{
				//console.log("DEBUG: ssShowplanSetParametersInSql('" + paramType + "'): e='" + e + "'.", e);

				let paramName  = e.getAttribute("Column");
				let paramValue = "-unknown-";

				if (paramType === "compile" && e.hasAttribute("ParameterCompiledValue"))
				{
					paramValue = e.getAttribute("ParameterCompiledValue");
				}

				if (paramType === "runtime" && e.hasAttribute("ParameterRuntimeValue"))
				{
					paramValue = e.getAttribute("ParameterRuntimeValue");
				}

				console.log("DEBUG: ssShowplanSetParametersInSql('" + paramType + "'): replace='" + paramName + "', with='" + paramValue + "'.");

				// SQL Text: get, change/replace(@p#), and set
				let sqlText = $("#dbx-view-ssShowplan-sqlContent").text();
				let newSqlText = sqlText.replaceAll(paramName, paramValue);
//				let newSqlText = sqlText.split(paramName).join(paramValue);
				$("#dbx-view-ssShowplan-sqlContent").text(newSqlText);
				Prism.highlightAll();
			});
		}

	</script>





	<script>
	/**
	* ---------------------------------------------------------------------------
	* -- View SQL Text
	* ---------------------------------------------------------------------------
	*/
	$('#dbx-view-sqltext-dialog').on('show.bs.modal', function(e) {
		var data = $(e.relatedTarget).data();

		console.log('#dbx-view-sqltext-dialog: data: '+data, data);

		$('#dbx-view-sqltext-objectName', this).text(data.objectname);
		$('#dbx-view-sqltext-sqlDialect', this).text(data.sqldialect); // note: small letters
		$('#dbx-view-sqltext-content',    this).text(data.tooltip);

		// highlight again, since the dialog DOM wasn't visible earlier
		Prism.highlightAll();

		// Scroll top top (do not seems to work)
		$('#dbx-view-sqltext-dialog').animate({ scrollTop: 0 }, 'slow');
	});

	$('#dbx-view-lockTable-dialog').on('show.bs.modal', function(e) {
		var data = $(e.relatedTarget).data();

		console.log('#dbx-view-lockTable-dialog: data: '+data, data);

		$('#dbx-view-lockTable-objectName', this).text(data.objectname);
		$('#dbx-view-lockTable-content',    this).html(data.tooltip);

		// highlight again, since the dialog DOM wasn't visible earlier
		//Prism.highlightAll();

		// Scroll top top (do not seems to work)
		$('#dbx-view-lockTable-dialog').animate({ scrollTop: 0 }, 'slow');
	});




	function formatXml(xml) {
		var formatted = '';
		var reg = /(>)(<)(\/*)/g;
		xml = xml.replace(reg, '$1\r\n$2$3');
		var pad = 0;
		jQuery.each(xml.split('\r\n'), function(index, node) {
			var indent = 0;
			if (node.match( /.+<\/\w[^>]*>$/ )) {
				indent = 0;
			} else if (node.match( /^<\/\w/ )) {
				if (pad != 0) {
					pad -= 1;
				}
			} else if (node.match( /^<\w[^>]*[^\/]>.*$/ )) {
				indent = 1;
			} else {
				indent = 0;
			}

			var padding = '';
			for (var i = 0; i < pad; i++) {
				padding += '  ';
			}

			formatted += padding + node + '\r\n';
			pad += indent;
		});

		return formatted;
	}

	</script>


	<!-- JAVA SCRIPT - INIT PAGE -->
	<script type="application/javascript">

		// used to hold Graph Filter "objects" for the Filter Dialog (initialized firt time the "filter" button is pressed)
		var _filterDialogContentArr = [];

		window.onload = function ()
		{
			// Do we support the browser...
			// Get version of MS: IE or Edge
			// IE or EDGE are not supported
			var ieVersion = detectIE();
			if (ieVersion !== false)
			{
				var browserVersion = ((ieVersion >= 12) ? 'Edge ' : 'IE ') + ieVersion;
				document.getElementById('api-feedback').innerHTML = "Current Browser: <b>" + browserVersion + "</b> may not work as expected. Please use Chrome, Firefox or Safari";
				// document.getElementById('api-feedback').innerHTML = "Current Browser: <b>" + browserVersion + "</b> is not supported. Please use Chrome, Firefox or Safari";
				// alert("Current Browser: " + browserVersion + " is not supported. Please use Chrome, Firefox or Safari");
				//return;
				if (ieVersion < 12)
				{
					document.getElementById('api-feedback').innerHTML = "<font color='red'>Current Browser: <b>" + browserVersion + "</b> is not supported. Please use Chrome, Firefox or Safari</font>";
					alert("Current Browser: " + browserVersion + " is not supported. Please use Chrome, Firefox or Safari");
					// return;
				}
			}

			// Get browsers window size
			console.log("Browser Window size: width="+$(window).width()+", height="+$(window).height());

			// handle parameters: gwidth & gcols
			// gwidth = is set as a approx width for the graphs, and then lets the grid-layout handler decide "how" it will be displayed
			// gcols  = on the current browser size, calculate what 'gwidth' should be be (gwidth = browserWindowWidth / gcols)
			var gwidth = getParameter("gwidth", 650);
			var gcols  = getParameter("gcols");
			if (gcols !== undefined)
			{
				console.log("gcols="+gcols);
				gwidth = $(window).width() / gcols -10;
			}
			console.log("gwidth="+gwidth);

			// grid thresholds: xs > 0px, sm > 640px, md > 860px, lg > 1080px, xl > 1300px
			// $('#graphs').css({
			//     "grid-gap": "0px",
			//     "--cols-xs": "1",
			//     "--cols-sm": "1",
			//     "--cols-md": "1",
			//     "--cols-lg": "2",
			//     "--cols-xl": "auto-fit", "--cols-size-xl": "minmax("+gwidth+"px, 1fr)"
			// });
			$('#graphs').css({
				"grid-gap": "0px",
				"--cols-xs": "1",
				"--cols-sm": "auto-fit", "--cols-size-sm": "minmax("+gwidth+"px, 1fr)",
				"--cols-md": "auto-fit", "--cols-size-md": "minmax("+gwidth+"px, 1fr)",
				"--cols-lg": "auto-fit", "--cols-size-lg": "minmax("+gwidth+"px, 1fr)",
				"--cols-xl": "auto-fit", "--cols-size-xl": "minmax("+gwidth+"px, 1fr)"
			});



			/**
			 * Initialize: Date Range Picker
			 */
			// var start = moment().subtract(2, 'hours');
			// var end = moment();

			function dateRangePickerCb(start, end, label)
			{
				console.log("CALLBACK: start="+start+", end="+end+", label="+label);
				// alert("CALLBACK: start="+start+", end="+end+", label="+label);

				if (label === "Last 2 Hours" || label === "Last 4 Hours" || label === "Last 6 Hours" || label === "Last 8 Hours" || label === "Last 12 Hours" || label === "Last 24 Hours" || label === "Today")
				{
					const url = new URL(window.location.href);
					var   startTime = "2h";

					if      (label === "Last 2 Hours")  startTime = "2h";
					else if (label === "Last 4 Hours")  startTime = "4h";
					else if (label === "Last 6 Hours")  startTime = "6h";
					else if (label === "Last 8 Hours")  startTime = "8h";
					else if (label === "Last 12 Hours") startTime = "12h";
					else if (label === "Last 24 Hours") startTime = "24h";
					else if (label === "Today")         startTime = start.format('YYYY-MM-DD HH:mm');

					url.searchParams.set("startTime", startTime);
					url.searchParams.set("subscribe", true);
					url.searchParams.delete("endTime");

					console.log("window.location.ref: "+url);
					window.location.assign(url);
				}
				else
				{
					const url = new URL(window.location.href);
					var   startTime = start.format('YYYY-MM-DD HH:mm');
					var   endTime   = end  .format('YYYY-MM-DD HH:mm');

					url.searchParams.set("startTime", startTime);
					url.searchParams.set("endTime",   endTime);
					url.searchParams.set("subscribe", false);

					console.log("window.location.ref: "+url);
					window.location.assign(url);
				}
				//$('#dbx-report-range span').html(start.format('YYYY-MM-DD HH:mm') + ' - ' + end.format('YYYY-MM-DD HH:mm'));
				if (moment(start).isSame(moment(), 'day') && moment(end).isSame(moment(), 'day'))
					$('#dbx-report-range span').html(start.format('HH:mm') + ' - ' + end.format('HH:mm'));
				else
					$('#dbx-report-range span').html(start.format('YYYY-MM-DD HH:mm') + ' - ' + end.format('YYYY-MM-DD HH:mm'));
			}

			$('#dbx-report-range').daterangepicker({
				// startDate: start,
				// endDate: end,
				startDate: moment().subtract(2, 'hours'),
				endDate:   moment(),
				timePicker: true,
				timePicker24Hour: true,
				timePickerIncrement: 5,
				ranges: {
					'Last 2 Hours':  [moment().subtract(2,  'hours'), moment()],
					'Last 4 Hours':  [moment().subtract(4,  'hours'), moment()],
					'Last 6 Hours':  [moment().subtract(6,  'hours'), moment()],
					'Last 8 Hours':  [moment().subtract(8,  'hours'), moment()],
					'Last 12 Hours': [moment().subtract(12, 'hours'), moment()],
					'Last 24 Hours': [moment().subtract(24, 'hours'), moment()],
					'Today':         [moment().startOf('day'), moment().endOf('day')],
					'Yesterday':     [moment().startOf('day').subtract(1,  'days'), moment().endOf('day').subtract(1, 'days')],
					'This Week':     [moment().startOf('isoWeek'), moment().endOf('isoWeek')],
					'Last 7 Days':   [moment().startOf('day').subtract(7,  'days'), moment().endOf('day')],
					'Last 2 Weeks':  [moment().startOf('day').subtract(14, 'days'), moment().endOf('day')],
					'Last 4 Weeks':  [moment().startOf('day').subtract(28, 'days'), moment().endOf('day')],
					'Last 30 Days':  [moment().startOf('day').subtract(30, 'days'), moment().endOf('day')],
					'This Month':    [moment().startOf('month'), moment().endOf('month')],
					'Last Month':    [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
				}
			});
			// }, dateRangePickerCb); // Using the callback caused "callback to be called" when user clickes "outside the picker"... su use elow 'apply.daterangepicker' instead

			// On daterangepicker-APPLY
			$('#dbx-report-range').on('apply.daterangepicker', function(ev, picker) {
				dateRangePickerCb(picker.startDate, picker.endDate, picker.chosenLabel);
			});

			// On daterangepicker-OPEN, set some start/end date
			$('#dbx-report-range').on('show.daterangepicker', function(ev, picker) {
				var startEndDate = $('#dbx-report-range span').html().split(" - ");
				if (startEndDate.length === 2)
				{
					console.log("on 'dbx-report-range': show(): setting: startDate=|"+startEndDate[0]+"|, endDate=|"+startEndDate[1]+"|.");
					picker.startDate = parseDate(startEndDate[0]);
					picker.endDate   = parseDate(startEndDate[1]);
				}

				// TODO: if graph[0] has a "timeline marker", then set the surounding time of 2 hours...
			});

			// dateRangePickerCb(start, end);

			// Install functions for buttons: dbx-prev-time, dbx-next-time
			$("#dbx-prev-day").click( function() {
				setNextPrevDay('prev');
			});
			$("#dbx-prev-time").click( function() {
				setNextPrevTime('prev');
			});
			$("#dbx-next-time").click( function() {
				setNextPrevTime('next');
			});
			$("#dbx-next-day").click( function() {
				setNextPrevDay('next');
			});

			function parseDate(dateString)
			{
				var longRegEx = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}/;
				if (dateString.match(longRegEx) != null)
					return moment(dateString);

				var shortRegEx = /^\d{2}:\d{2}/;
				if (dateString.match(shortRegEx) != null)
					return moment(dateString, 'HH:mm');

				var msg = "parseDat(): unknown date '"+dateString+"' was passed. do not match 'YYYY-MM-DD HH:mm' or 'HH:mm'";
				console.log(msg);
				return msg;
			}

			function setNextPrevTime(type)
			{
				var currentHourSpan = parseInt( $("#dbx-sample-time").html().replace("h", "") );
				if (isNaN(currentHourSpan))
					return;
				if (currentHourSpan === 0)
					currentHourSpan = 1;

				var startEndDate = $('#dbx-report-range span').html().split(" - ");
				if (startEndDate.length === 2)
				{
					console.log("button: "+type+"-time: currentHourSpan=|"+currentHourSpan+"|, startDate=|"+startEndDate[0]+"|, endDate=|"+startEndDate[1]+"|.");
					var startDate = parseDate(startEndDate[0]);
					var endDate   = parseDate(startEndDate[1]);

					if (type === "prev") {
						startDate = startDate.subtract(currentHourSpan, 'hours');
						endDate   = endDate  .subtract(currentHourSpan, 'hours');
					}
					else if (type === "next") {
						startDate = startDate.add(currentHourSpan, 'hours');
						endDate   = endDate  .add(currentHourSpan, 'hours');
					}
					console.log("button: "+type+"-time: AFTER adjust: currentHourSpan=|"+currentHourSpan+"|, startDate=|"+startDate.format('YYYY-MM-DD HH:mm')+"|, endDate=|"+endDate.format('YYYY-MM-DD HH:mm')+"|.");

					// USE: the daterangepicker callback to set START/END time
					dateRangePickerCb(startDate, endDate, type);
				}
			}

			function setNextPrevDay(type)
			{
//				var currentHourSpan = parseInt( $("#dbx-sample-time").html().replace("h", "") );
//				if (isNaN(currentHourSpan))
//					return;
//				if (currentHourSpan === 0)
//					currentHourSpan = 1;

				var startEndDate = $('#dbx-report-range span').html().split(" - ");
				if (startEndDate.length === 2)
				{
					var startDate = parseDate(startEndDate[0]);
					var endDate   = parseDate(startEndDate[1]);

					if (type === "prev") {
						startDate = startDate.subtract(1, 'days');
						endDate   = endDate  .subtract(1, 'days');
					}
					else if (type === "next") {
						startDate = startDate.add(1, 'days');
						endDate   = endDate  .add(1, 'days');
					}
					console.log("button: "+type+"-time: AFTER adjust: startDate=|"+startDate.format('YYYY-MM-DD HH:mm')+"|, endDate=|"+endDate.format('YYYY-MM-DD HH:mm')+"|.");

					// USE: the daterangepicker callback to set START/END time
					dateRangePickerCb(startDate, endDate, type);
				}
			}

			// Install functions for button: dbx-filter
			$("#dbx-filter").click( function()
			{
				dbxOpenFilterDialog();
			});

			// Install functions for button: dbx-history (on/off)
			$("#dbx-history-on") .click( function() { dbxHistoryAction(); });
			$("#dbx-history-off").click( function() { dbxHistoryAction(); });

			// Make Bootsrap Modal Dialogs, resizable & movable (on the head)
			var isSafari = !!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);
			var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
			if ( ! (isSafari && iOS) )
			{
				// All modals dialogs
				$('.modal-content').resizable({ alsoResize: ".modal-dialog" });
				$('.modal-dialog').draggable({ handle: ".modal-header" });

				// Statements
				$('.active-statements-class').resizable({ handles: 'n, w, nw, s, sw' });
//				$('.active-statements-class').resizable({ handles: 'all' });
				$('.active-statements-class').draggable({ handle: ".active-statements-ctl-class" });

				// Active Alarms
				$('.active-alarms-class').resizable({ handles: 'n' });
				$('.active-alarms-class').draggable({ handle: ".active-alarms-ctl-class" });
			}

			$('#dbx-filter-dialog').on('show.bs.modal', function () {
				$(this).find('.modal-body').css({
					'max-height':'100%'
				});
			});

			// What should happen when we click OK in the dialog
			$("#dbx-filter-dialog-ok").click( function()
			{
				$('#dbx-filter-dialog').modal('hide');

				var selectedRecords = $('#dbx-graph-filter-table').bootstrapTable('getSelections');

				// hide ALL graphs
				for(let i=0; i<_graphMap.length; i++)
				{
					const dbxGraph = _graphMap[i];
					var x = document.getElementById(dbxGraph.getFullName());
					x.style.display = 'none';
					// console.log('HIDE: x='+x, x);
				}
				// show marked ones ALL graphs
				for (let i = 0; i < selectedRecords.length; i++)
				{
					const record = selectedRecords[i];
					var x = document.getElementById(record.fullName);
					x.style.display = 'block';
					// console.log('SHOW: x='+x, x);
				}
			});

			/**
			 * LOAD DBXTUNE GRAPHS/CHARTS
			 */
			dbxTuneLoadCharts("graphs");

			// Check if we got any SQL Statements that are active
			dbxTuneCheckActiveStatements();

			// Check if we got any alarms that are active
			dbxTuneCheckActiveAlarms();

			/* Start to subscribe to data, sent by the backend-server */
			dbxTuneGraphSubscribe();
		}
		function scrollToFormatter(value, row, index)
		{
			// console.log("scrollToFormatter: index="+index, row);
			// return '<a href="javascript:void(0)" onclick="scrollToAction('+ row.fullName +')">GoTo</a>';
			return '<a href="javascript:void(0)" onclick="scrollToAction('+ row.fullName +')"><span class="glyphicon fa fa-arrow-circle-right"></span></a>';
		}
		function scrollToAction(name)
		{
			console.log("scrollToAction: name="+name, name);
			$('#dbx-filter-dialog').modal('hide');
			// name.scrollIntoView();
			var topOfElement = name.offsetTop - 150;
			// window.scroll({ top: topOfElement, behavior: "smooth" });
			window.scroll({ top: topOfElement });

			// $(name).scrollTo(150);
			// $('html, body').animate({
			//     scrollTop: ($(name).offset().top)
			// },500);
			$(name).effect( "bounce", {times:5}, 1000 );
		}
		function scrollToDisableCheckRow(element)
		{
			console.log("scrollToDisableCheckRow: element="+element, element);
			return $.inArray(element.tagName, ['A', 'BUTTON']);
		}

		function dbxOpenFilterDialog()
		{
			// loop all available graphs and add it to the table in the dialog
			if (_filterDialogContentArr.length === 0)
			{
				for(let i=0; i<_graphMap.length; i++)
				{
					const dbxGraph = _graphMap[i];

					var row = {
						"visible"   : true,
						"desc"      : dbxGraph.getGraphLabel(),
						"type"      : dbxGraph.getGraphCategory(),
						"cm"        : dbxGraph.getCmName(),
						"graphName" : dbxGraph.getGraphName(),
						"fullName"  : dbxGraph.getFullName(),
					};
					_filterDialogContentArr.push(row);
				}

				$('#dbx-graph-filter-table').bootstrapTable({data: _filterDialogContentArr});
			}

			// Show the dialog
			$("#dbx-filter-dialog").modal('show');
		}

		/**
		 * Get History Array position for a specififc time
		 * returns -1 if not found
		 */
		function getHistoryArrayPosForTs(momentTs)
		{
			if (_lastHistoryMomentsArray === undefined) return -1;
			if (_lastHistoryMomentsArray === null     ) return -1;

			let momentsArray  = _lastHistoryMomentsArray;
			let momentTsEpoch = momentTs.valueOf();

			for (var m=0; m<momentsArray.length; m++)
			{
				let startTime = momentsArray[m].valueOf();
				let endTime   = momentsArray[momentsArray.length-1].add(1, 'minute'); // set one minute past the "last" array time
				if (m + 1 < momentsArray.length)
					endTime = momentsArray[m + 1].valueOf();

				if (momentTsEpoch >= startTime && momentTsEpoch < endTime)
				{
					console.log("######################## getHistoryArrayPosForTs(ts=|" + momentTs + "|) #### FOUND-POS ################ --m=" + m);
					return m;
				}
			}
			return -1;
		}

		// Used to deferr calling of "loadHistory" on slider "change event"
		var _historyLoadDeferredTimerId = -1;

		function dbxHistoryAction(momentTs)
		{
			var isHistoryViewEnabled = $("#dbx-history-container-div").is(":visible");

			console.log("dbxHistoryAction(momentTs=|" + momentTs + "|): isHistoryViewEnabled=" + isHistoryViewEnabled);

			// Change to NORMAL MODE
			if (isHistoryViewEnabled && momentTs === undefined)
			{
				console.log("HISTORY: is HIDDEN... reloading page");

				// Reload current page to get in "normal" mode again
				location.reload();
				return;
			}

			// Update Slider pos to a specififc timestamp
			// and *fire* the "change" event on the slider
			if (isHistoryViewEnabled && momentTs !== undefined)
			{
				let toArrayPos = getHistoryArrayPosForTs(momentTs);
				if (toArrayPos > 0)
				{
					let sliderPos = toArrayPos + 1;
					console.log("DEBUG: set the slider to value. toArrayPos=" + toArrayPos + ", sliderPos=" + sliderPos);

					var dbxHistoryTimelineSlider = document.getElementById('dbx-history-timeline-slider');

					dbxHistoryTimelineSlider.value = sliderPos;
					dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
				}
				return;
			}

			// Change to HISTORY MODE
			if (true)
			{
				console.log("HISTORY: is VISIBLE");

				// Show the dialog
				$("#dbx-history-container-div").toggle();

				// Toogle the buttons
				$("#dbx-history-on") .toggle();
				$("#dbx-history-off").toggle();

				// HIDE alarms
				$("#active-alarms-top").hide();
				$("#active-alarms")    .hide();

				// Show "History View Mode"
//				$("#dbx-history-label-top").show();
				var historyLabelTopDiv = document.getElementById("dbx-history-label-top");
				historyLabelTopDiv.style.visibility = 'visible';


				console.log("_graphMap.length=" + _graphMap.length);
				if (_graphMap.length > 0)
				{
					let dbxGraph = _graphMap[0];
//					console.log("dbxGraph=" + dbxGraph);
//					console.log("dbxGraph=" + dbxGraph, dbxGraph);

//					console.log("dbxGraph.getTsArraySize() = " + dbxGraph.getTsArraySize());
//					console.log("dbxGraph.getTsArray()     = " + dbxGraph.getTsArray() , dbxGraph.getTsArray());
//					console.log("dbxGraph.getOldestTs()    = " + dbxGraph.getOldestTs(), dbxGraph.getOldestTs());
//					console.log("dbxGraph.getNewestTs()    = " + dbxGraph.getNewestTs(), dbxGraph.getNewestTs());

//					console.log("dbxGraph.getOldestTs() fmt= " + dbxGraph.getOldestTs().format('YYYY-MM-DD HH:mm:ss'));
//					console.log("dbxGraph.getNewestTs() fmt= " + dbxGraph.getNewestTs().format('YYYY-MM-DD HH:mm:ss'));

					$("#dbx-history-slider-left-text") .html( dbxGraph.getOldestTs().format('YYYY-MM-DD HH:mm:ss') );
					$("#dbx-history-slider-right-text").html( dbxGraph.getNewestTs().format('YYYY-MM-DD HH:mm:ss') );

					// Clone the ChartJS ts data.labels (where the moment/ts objects are located)
					// So we dont make a mistake and changes the underlying Moment/time objects
					const momentsArray = [];
					const tmpArray = dbxGraph.getTsArray();
					for (let t=0; t<tmpArray.length; t++)
					{
//console.log("tmpArray["+t+"]: typeof |" + (typeof tmpArray[t]) + "|, ObjectName=|" + tmpArray[t].constructor.name + "|");
						momentsArray.push( tmpArray[t].clone() );
					}


					// Save it as a GLOBAL var, so we can do lookups on it as well...
					_lastHistoryMomentsArray = momentsArray;

					let oldestTsStr = dbxGraph.getOldestTs().format('YYYY-MM-DD HH:mm:ss');
					let newestTsStr = dbxGraph.getNewestTs().format('YYYY-MM-DD HH:mm:ss');
					var activeHistoryStatementsArr = dbxTuneGetActiveHistoryStatements(oldestTsStr, newestTsStr);
//console.log(">>>>> activeHistoryStatementsArr=" + activeHistoryStatementsArr, activeHistoryStatementsArr);
//console.log(">>>>> activeHistoryStatementsArr.lenth=" + activeHistoryStatementsArr.length);
//console.log(">>>>> momentsArray.lenth=" + momentsArray.length);

					// Create an array with Booleans, that indicates if it HAS an Statement for the time in the 'momentsArray'
					const hasActiveHistoryStatementArr = [];
					for (var m=0; m<momentsArray.length; m++)
					{
//console.log("--m="+m+"---------------------------------");

						let startTime = momentsArray[m].valueOf();
						let endTime   = momentsArray[momentsArray.length-1].clone().add(1, 'minute').valueOf(); // set one minute past the "last" array time... clone() so that we don't change the original object
						if (m + 1 < momentsArray.length)
							endTime = momentsArray[m + 1].valueOf();

						var hasActiveHistoryStatement = -1;
						for (var h=0; h<activeHistoryStatementsArr.length; h++)
						{
							let tmpSampleTime = activeHistoryStatementsArr[h].sampleTime;
							if (tmpSampleTime >= startTime && tmpSampleTime < endTime)
							{
//console.log("######################## TRUE ################ --m=" + m + " --h=" + h);
								hasActiveHistoryStatement = h;
								break;
							}
//console.log("moment["+m+"](" + momentsArray[m].format('YYYY-MM-DD HH:mm:ss') + ")===activeHistoryStatementsArr["+h+"](" + moment(activeHistoryStatementsArr[h].sampleTime).format('YYYY-MM-DD HH:mm:ss') + ") ===> " + hasActiveHistoryStatement);
						}

						hasActiveHistoryStatementArr.push(hasActiveHistoryStatement);
					}
//console.log(">>>>> hasActiveHistoryStatementArr.lenth=" + hasActiveHistoryStatementArr.length, hasActiveHistoryStatementArr);
					// Save the array to a global value -- used to find NEXT/PREV active History Statement
					_hasActiveHistoryStatementArr = hasActiveHistoryStatementArr;

					// lets see what a Plain Slider gets us
					var dbxHistoryTimelineSlider = document.getElementById('dbx-history-timeline-slider');

					// Set tooltip
					dbxHistoryTimelineSlider.title = ""
						+ "Navigation: \n"
						+ "The gray/green bar under the slider, indicates where there are Active Statements \n"
						+ " - Use 'Ctrl+left' for Previous Active Statement \n"
						+ " - Use 'Ctrl+right' for Next Active Statement \n"
						+ " - or simply left/right arrows to move in the slider. \n"
						+ " - or click on any 'line' on any Graph. \n"
						+ "Note: Clicking a Graph, but not on a 'line', causes you to leave 'History View Mode' \n"
						+ "";

					// Clear existing data marks
					var existingDots = document.getElementsByClassName('dbx-history-timeline-slider-marker');
					while (existingDots[0])
						existingDots[0].parentNode.removeChild(existingDots[0]);

					// Create data marks
					dbxHistoryTimelineSlider.max = momentsArray.length;
					for (var m=0; m<momentsArray.length; m++)
					{
						// TODO: Possibly change witdh of "marker" depending on "momentsArray.length" ????  (but it needs to be tested on various sizes)

						var color = hasActiveHistoryStatementArr[m] >= 0 ? "green" : "gray";
						var markElement = document.createElement('div');
						markElement.className = 'dbx-history-timeline-slider-marker';
						markElement.style.backgroundColor = color;
						var position = (m / dbxHistoryTimelineSlider.max) * 100;
						markElement.style.left = position + '%';
						dbxHistoryTimelineSlider.parentNode.appendChild(markElement);

						if (hasActiveHistoryStatementArr[m] >= 0)
						{
							var obj = activeHistoryStatementsArr[ hasActiveHistoryStatementArr[m] ];
							markElement.title = ""
								+ "sampleTime: " + obj.sampleTimeIso8601 + "\n"
								+ "SrvName: " + obj.srvNames[0].srvName  + "\n"
								+ "AppName: " + obj.srvNames[0].appName  + "\n"
								+ "CmNames: " + obj.srvNames[0].cmNames  + "\n"
								+ "atPos:   " + m + "\n"
								;
							let sliderPos = m + 1;
							markElement.onclick = function()
							{
								dbxHistoryTimelineSlider.value = sliderPos;
								dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
							};
						}
						else
						{
//							markElement.title = momentsArray[m].format('YYYY-MM-DD HH:mm:ss');
							markElement.title = momentsArray[m].format('YYYY-MM-DD HH:mm:ss') + "  atPos: " + m;

							let sliderPos = m + 1;
							markElement.onclick = function()
							{
								dbxHistoryTimelineSlider.value = sliderPos;
								dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
							};
						}
					}

					// ADD 'input' listener -- when we are moving the slider (without stopping)
					dbxHistoryTimelineSlider.addEventListener('input', function(event)
					{
						let value = parseInt(event.target.value) - 1;
//						console.log("Slide=" + value);
						let selectedTs = momentsArray[value];
						$( "#dbx-history-slider-center-text" ).html( selectedTs.format('YYYY-MM-DD HH:mm:ss') );
					});

					// ADD 'change' listener -- when we are finnished moving slider (do ACTION)
					dbxHistoryTimelineSlider.addEventListener('change', function(event)
					{
						let value = parseInt(event.target.value) - 1;
						console.log("Change=" + value);

						let momentTs     = momentsArray[value];
						let startTime    = momentsArray[value].format('YYYY-MM-DD HH:mm:ss');
						let endTime      = momentsArray[momentsArray.length-1].clone().add(1, 'minute').format('YYYY-MM-DD HH:mm:ss'); // set one minute past the "last" array time, clone (to not change the value inside moment)
						let endTimeShort = "";

						if (value + 1 < momentsArray.length)
						{
							momentTs     = momentsArray[value + 1];
							endTime      = momentsArray[value + 1].format('YYYY-MM-DD HH:mm:ss');
							endTimeShort = momentsArray[value + 1].format('HH:mm:ss');
						}

						$( "#dbx-history-slider-center-text" ).html( startTime + " - " + endTimeShort);

						// Cancel the below timer-action (if we get *multiple* change events after each other)
						if (_historyLoadDeferredTimerId !== -1)
							clearTimeout(_historyLoadDeferredTimerId);
						
						// Call the "load action" AFTER 300ms, so a DEFERRED Execution, to not "overload" on slider movements (via left/right arrow movement)
						_historyLoadDeferredTimerId = setTimeout(function() 
						{
							dbxTuneGetHistoryStatements( startTime, endTime );

							// it looks like setting the "timeline marker", takes a long time...
							// SO for now the method: only set the "timeline marker" for the elements which is Visible in the Viewport
							dbxTuneSetTimeLineMarkerForAllGraphs(momentTs, value);

							// Set focus so we can do: Ctrl + left/right
							dbxHistoryTimelineSlider.focus();

						}, 300);
					});

					// Install slider keyboard: Ctrl+left, Ctrl+right
					dbxHistoryTimelineSlider.addEventListener('keydown', function(event)
					{
						if (event.ctrlKey && event.key === "ArrowLeft")
						{
							console.log("XXXXXXXXXXX slider: ctrl+left");
							event.preventDefault();
							dbxHistoryPrevActiveStatement();
						}

						if (event.ctrlKey && event.key === "ArrowRight")
						{
							console.log("XXXXXXXXXXX slider: ctrl+right");
							event.preventDefault();
							dbxHistoryNextActiveStatement();
						}
					});
				}

				// Set slider to the END
				dbxHistoryTimelineSlider.value = dbxHistoryTimelineSlider.max;
				dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
			}
		}

		function dbxHistoryPrevActiveStatement()
		{
			let dbxHistoryTimelineSlider = document.getElementById('dbx-history-timeline-slider');
			let currentSliderPos = parseInt(dbxHistoryTimelineSlider.value); // NOTE: 'value' is typeof 'string'
			let startArrPos = currentSliderPos - 2;

			// loop backward to find previous
			let arrayPos = -1; // not found
			for (var h=startArrPos; h>0; h--)
			{
				if (_hasActiveHistoryStatementArr[h] !== -1)
				{
					arrayPos = h;
					break;
				}
			}
			if (arrayPos !== -1)
			{
				console.log("PREVIOUS Active Statement was found at ArrayPos=" + arrayPos);
				dbxHistoryTimelineSlider.value = arrayPos + 1;
				dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
			}
			else
			{
				console.log("PREVIOUS Active Statement was NOT found");
			}
		}

		function dbxHistoryNextActiveStatement()
		{
			let dbxHistoryTimelineSlider = document.getElementById('dbx-history-timeline-slider');
			let currentSliderPos = parseInt(dbxHistoryTimelineSlider.value); // NOTE: 'value' is typeof 'string'
			let startArrPos = currentSliderPos;

			// loop forward to find next
			let arrayPos = -1; // not found
			for (var h=startArrPos; h<_hasActiveHistoryStatementArr.length; h++)
			{
				if (_hasActiveHistoryStatementArr[h] !== -1)
				{
					arrayPos = h;
					break;
				}
			}

			if (arrayPos !== -1)
			{
				console.log("NEXT Active Statement was found at ArrayPos=" + arrayPos);
				dbxHistoryTimelineSlider.value = arrayPos + 1;
				dbxHistoryTimelineSlider.dispatchEvent( new Event('change') );
			}
			else
			{
				console.log("NEXT Active Statement was NOT found");
			}
		}

		//
/*
		$("#active-statements").on('scroll', function() {
			let xxx = $("#active-statements");
			let leftPos = $("#active-statements").scrollLeft();
			console.log("leftPos: " + leftPos);
			$(".active-statements-srv-info-class").css("left", leftPos + "px");
			$(".active-statements-srv-info-class").css("background-color", "red"); // just to indicate that "something" is happening... to be removed
		});
*/

	</script>

</body>

</html>
