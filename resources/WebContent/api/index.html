<!doctype html>
<html lang="en">
	<head>
		<title>API Documentation</title>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!--  
		======================================================================= 
		== JS imports - JAVA SCRIPTS GOES HERE 
		======================================================================= 
		--> 
		<!-- JS: JQuery --> 
		<script type='text/javascript' src='/scripts/jquery/jquery-3.7.0.min.js'></script> 
		
		<!-- JS: Bootstrap --> 
		<script type="text/javascript" src='/scripts/popper/1.12.9/popper.min.js'></script> 
		<script type="text/javascript" src='/scripts/bootstrap/js/bootstrap.min.js'></script> 
		
		<!--  
		======================================================================= 
		== CSS imports - STYLES SHEETS GOES HERE 
		======================================================================= 
		--> 
		
		<!-- CSS: Bootstrap --> 
		<link rel='stylesheet' href='/scripts/bootstrap/css/bootstrap.min.css'> 
		
		<!-- CSS: Font Awsome --> 
		<link rel='stylesheet' href='/scripts/font-awesome/4.4.0/css/font-awesome.min.css'> 
	

		<style type='text/css'>
		  table {border-collapse: collapse;}
		  th {border: 1px solid black; text-align: left; padding: 2px; background-color:gray; color:white;}
		  td {border: 1px solid black; text-align: left; padding: 2px; }
		/*  th {border: 1px solid black; text-align: left; padding: 2px; white-space: nowrap; background-color:gray; color:white;} */
		/*  td {border: 1px solid black; text-align: left; padding: 2px; white-space: nowrap; } */
		  tr:nth-child(even) {background-color: #f2f2f2;}
		</style>
	</head>

	<body>
	<div class="container">
<!--	<div class="container-fluid">-->

		<h2>API interface, description</h2>


		<!-- ############################################################################# -->
		<div id='/api/sessions' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/sessions?type=last&graphs=false&status=all'>/api/sessions</a></h5>
		<div class='card-body'>
		What sessions are available, and some basic information about that session.<br>
		<br>
		Parameters:
		<table>
			<!--     ======          =================          =========== -->
			<tr> <th>Name  </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ======          =================          =========== -->
			<tr> <td>type  </td> <td>last             </td>     <td>
			                                                        <code>last</code> Show info about last available session<br>
			                                                        <code>all</code> Show all available recordings for this server/session<br>
			                                                    </td> </tr>
			<tr> <td>graphs</td> <td>false            </td>     <td><code>true|false</code> if we should include available graphs for this session in the output</td> </tr>
			<tr> <td>status</td> <td>all              </td>     <td>Show only with some specific status. </td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->
		

		<!-- ############################################################################# -->
		<div id='/api/server-layout' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/server-layout'>/api/server-layout</a></h5>
		<div class='card-body'>
		What Server/Sessions are available, and how they should be laid out on the landing page (where all Servers are shown).<br>
		<br>
		Parameters: none
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->
		

		<!-- ############################################################################# -->
		<div id='/api/graphs' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/graphs?sessionName=SRVNAME'>/api/graphs</a></h5>
		<div class='card-body'>
		What graphs are available for a specific server/session or profile<br>
		<br>
		Parameters:
		<table>
			<!--     ================          =================          =========== -->
			<tr> <th>Name            </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ================          =================          =========== -->
			<tr> <td>sessionName     </td> <td><b>mandatory</b> </td> <td>Name of the server/session/profile</td> </tr>
			<tr> <td>sessionStartTime</td> <td>last session     </td> <td>Specify a specific start time (default is "last session") </td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/graph/profiles' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/graph/profiles?name=PROFILE_NAME'>/api/graph/profiles</a></h5>
		<div class='card-body'>
		What graph profiles are available<br>
		<br>
		Parameters:
		<table>
			<!--     ===========          =================          =========== -->
			<tr> <th>Name       </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ===========          =================          =========== -->
			<tr> <td>name       </td> <td><b>mandatory</b> </td> <td>name of the profile we want to get details for</td> </tr>
			<tr> <td>user       </td> <td>                 </td> <td>If the profile is for a specific user </td> </tr>
			<tr> <td>dbxTypeName</td> <td>                 </td> <td>If the profile is for a specific product (AseTune, RsTune, PostgresTune, SqlServerTune...) </td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/graph/description' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/graph/description'>/api/graph/description</a></h5>
		<div class='card-body'>
		What graph profiles are available<br>
		<br>
		Parameters:
<!-- 
		<table>
			<tr> <th>Name       </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<tr> <td>name       </td> <td>                 </td> <td>name of the profile we want to get details for</td> </tr>
			<tr> <td>user       </td> <td>                 </td> <td>If the profile is for a specific user </td> </tr>
			<tr> <td>dbxTypeName</td> <td>                 </td> <td>If the profile is for a specific product (AseTune, RsTune, PostgresTune, SqlServerTune...) </td> </tr>
		</table>
-->
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/healthcheck' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/healthcheck?srvInfo=false&srv='>/api/healthcheck</a></h5>
		<div class='card-body'>
		If the server is healthy or not<br>
		<br>
		Parameters:
		<table>
			<!--     ====             =================          =========== -->
			<tr> <th>Name   </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ====             =================          =========== -->
			<tr> <td>srv    </td> <td>all-servers      </td> <td>name of the server we want to get details for</td> </tr>
			<tr> <td>age    </td> <td>sampleInterval*20</td> <td>Number of minutes the collector has not sent any data to DbxCentral
			                                                     <ul>
			                                                         <li><code>Less than 0: </code> Do not check Data Received</li>
			                                                         <li><code>Equal to 0:  </code> Calculate the threshold by: CollectorSampleInterval * 20 (so for 30 seconds interval, the result will be 10 minutes)</li>
			                                                         <li><code>Above 0:     </code> Number of <b>minutes</b> we havn't received any data... if above = mark as "not healthy"</li>
			                                                     </ul>
			                                                 </td> </tr>
			<tr> <td>srvInfo</td> <td>true</td>              <td>Include server info in the result</td> </tr>
			<tr> <td>result </td> <td>array</td>             <td>Result type, can be 'arr', 'array' or 'map'</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/api/last-sample' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/last-sample'>/api/last-sample?srv=SRV_NAME&cm=CmActiveStatements</a></h5>
		<div class='card-body'>
		Get info about <b>LAST Counters</b> for a specific CmName<br>
		An empty JSON Map, means that there are no Counters found.<br>
		<br>
		Parameters:
		<table>
			<!--     ====          =================          =========== -->
			<tr> <th>Name</th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ====          =================          =========== -->
			<tr> <td>srv </td> <td>all servers      </td> <td>name of the server we want to get details for</td> </tr>
			<tr> <td>cm  </td> <td>mandatory        </td> <td>name of the CM (CounterModel) we want to get details for</td> </tr>
		</table>
		<br>
		JSON Output Example:
		<pre>
			[ {
			  "srvName" : "GORAN_UB3_DS",
			  "appName" : "AseTune",
			  "cmNames" : [ {
			    "cmName" : "CmActiveStatements",
			    "lastSample" : {
			      "counters" : { 
			        "metaData" : [ { "columnName" : "xxx", "jdbcTypeName" : "xxx", "javaClassName" : "xxx", "guessedDbmsType" : "xxx", "isDiffColumn" : false, "isPctColumn" : false }, ...moreMetaDataColumns... ],
			        "absCounters" : [ {row0}, {row1}, ...moreRows... ],
			        "diffCounters" : [ {row0}, {row1}, ...moreRows... ],
			        "rateCounters" : [ {row0}, {row1}, ...moreRows... ],
			      }
			    }
			  }, ...moreCmNames... ]
			}, ...moreSrvNames... ]
		</pre>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/api/alarm/active' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/alarm/active'>/api/alarm/active</a></h5>
		<div class='card-body'>
		Get info about <b>active</b> alarms<br>
		An empty JSON array, means that there are no active alarms.<br>
		<br>
		Parameters:
		<table>
			<!--     ====          =================          =========== -->
			<tr> <th>Name</th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ====          =================          =========== -->
			<tr> <td>srv </td> <td>all servers      </td> <td>name of the server we want to get details for</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/api/alarm/history' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/alarm/history?srv=SRVNAME'>/api/alarm/history</a></h5>
		<div class='card-body'>
		Get info about <b>historical</b> alarms, all alarms that has been triggered in the past<br>
		<br>
		Parameters:
		<table>
			<!--     ==========        =================          =========== -->
			<tr> <th>Name    </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========        =================          =========== -->
			<tr> <td>srv     </td> <td>                 </td> <td>name of the server we want to get details for</td> </tr>
			<tr> <td>age     </td> <td>                 </td> <td>not yet implemented: only within X hours</td> </tr>
			<tr> <td>type    </td> <td>                 </td> <td>not yet implemented: only 'RAISE', 'RE-RAISE', 'CANCEL'</td> </tr>
			<tr> <td>category</td> <td>                 </td> <td>not yet implemented: only for category 'CPU', 'DISK'...</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/graph/data' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/graph/data?sessionName=SRVNAME&cmName=CmSummary&graphName=aaCpuGraph&startTime=2h'>/api/graph/data</a></h5>
		<div class='card-body'>
		Get graph data<br>
		<br>
		Parameters:
		<table>
			<!--     ==============          =================          =========== -->
			<tr> <th>Name          </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==============          =================          =========== -->
			<tr> <td>sessionName   </td> <td><b>mandatory</b> </td> <td>Name of the server</td> </tr>
			<tr> <td>cmName        </td> <td>                 </td> <td>Name of a specific collector</td> </tr>
			<tr> <td>graphName     </td> <td>                 </td> <td>Name of a specific graph</td> </tr>
			<tr> <td>startTime     </td> <td>2h               </td> <td>Optional: From what time: Can be a 'iso8601' or '#m|#h|#d' (Minutes, Hours or Day) (default=2h)</td> </tr>
			<tr> <td>endTime       </td> <td>                 </td> <td>Optional: To what time Can be a 'iso8601' or '#m|#h|#d' (Minutes, Hours or Day) if startTime is 'date' then #mhd is added to startTime (default='')</td> </tr>
			<tr> <td>sampleType    </td> <td>AUTO             </td> <td>Optional: (default=AUTO)<br>
			                                                               <code>ALL             </code> get <b>all</b> saved data points<br>
			                                                               <code>AUTO            </code> Uses a automatic formula, normally uses ALL, if there are to many data-points in the sample intervall, then switch over to: MAX_OVER_SAMPLES or MIN_OVER_SAMPLES<br>
			                                                               <code>MAX_OVER_SAMPLES</code> Only take the MAX value from X samples, this can be used if there are to many samples<br>
			                                                               <code>MIN_OVER_SAMPLES</code> Only take the MIN value from X samples, this can be used if there are to many samples<br>
			                                                               <code>MAX_OVER_MINUTES</code> Only take the MAX value from a sample over X minutes, this can be used if there are to many samples<br>
			                                                               <code>MIN_OVER_MINUTES</code> Only take the MIN value from a sample over X minutes, this can be used if there are to many samples<br>
			                                                               <code>AVG_OVER_MINUTES</code> Only take the Average value from a sample over X minutes, this can be used if there are to many samples<br>
			                                                               <code>SUM_OVER_MINUTES</code> Sum all values from a sample over X minutes, this can be used if there are to many samples<br>
			                                                               > </tr>
			<tr> <td>sampleValue   </td> <td>                 </td> <td>Optional: Used when NOT ALL or AUTO to set how many data-points/samples or minutes that we should do MIN/MAX/AVG/SUM over</td> </tr>
			<tr> <td>autoOverflow  </td> <td>                 </td> <td>Optional: Used with 'AUTO' to "skip" data-points if there are to many. (default='360', if we find more than 360 data-points, then switch to 'MAX_OVER_SAMPLES')</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/chart/broadcast-ws' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/chart/broadcast-ws'>/api/chart/broadcast-ws</a></h5>
		<div class='card-body'>
		Start to subscribe (using a WebSocket) to graph data (graph data will be "pushed" from DbxCentral to your browser/client)<br>
		<br>
		Parameters:
		<table>
			<!--     ==========          =================          =========== -->
			<tr> <th>Name      </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========          =================          =========== -->
			<tr> <td>serverList</td> <td><b>mandatory</b> </td> <td>comma separated list of server/session names we want to subscribe to</td> </tr>
			<tr> <td>graphList </td> <td></td>                  <td>comma separated list of graph names we want to subscribe to</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/api/pcs/receiver' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/pcs/receiver'>/api/pcs/receiver</a></h5>
		<div class='card-body'>
		This is where Dbx Central receives data from any DbxTune Collector.<br>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/api/pcs/queueInfo' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/pcs/queueInfo'>/api/pcs/queueInfo</a></h5>
		<div class='card-body'>
		Inbound PCS Queue Size. How many entries are in the Queue waiting to be stored by the Persistence Storage.<br>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/api/collector-refresh' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/api/collector-refresh?srv=SRVNAME'>/api/collector-refresh</a></h5>
		<div class='card-body'>
		Send a refresh request to a collector server.<br>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		
		
		<h2>Other URL, descriptions</h2>

		<!-- ############################################################################# -->
		<div id='/admin' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/admin'>/admin</a></h5>
		<div class='card-body'>
		Various admin commands (not published yet).<br>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/admin/shutdown' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/admin/shutdown'>/admin/shutdown</a></h5>
		<div class='card-body'>
		Shutdown or restart DbxCentral.<br>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/alarmLog' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/alarmLog?name=ALARM.LOG.SRVNAME.log'>/alarmLog</a></h5>
		<div class='card-body'>
		Get alarm log file
		<br>
		Parameters:
		<table>
			<!--     ==========        =================          =========== -->
			<tr> <th>Name    </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========        =================          =========== -->
			<tr> <td>name    </td> <td><b>mandatory</b> </td> <td>Name of the file (only the filename, not full path)</td> </tr>
			<tr> <td>type    </td> <td>                 </td> <td>for example: RAISE, CANCEL</td> </tr>
			<tr> <td>method  </td> <td>html             </td> <td>can be: 'pcs', 'json', 'html'</td> </tr>
			<tr> <td>age     </td> <td>                 </td> <td>for 'pcs' only: YYYY-MM-DD hh:mm:ss or -10, 10m, 10h, 10d, 10l (-10=last-10-rows, 10m=last-10-minutes, 10h=last-10-hours, 10d=last-10-days, 10l=last-10-rows)</td> </tr>
		</table>
		
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/log' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/log?name=SRVNAME.log&method=plain&discard=&tail=500'>/log</a></h5>
		<div class='card-body'>
		Get log file
		<br>
		Parameters:
		<table>
			<!--     ==========        =================          =========== -->
			<tr> <th>Name    </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========        =================          =========== -->
			<tr> <td>name    </td> <td><b>mandatory</b> </td> <td>Name of the file (only the filename, not full path)</td> </tr>
<!--		<tr> <td>type    </td> <td>                 </td> <td></td> </tr>-->
			<tr> <td>method  </td> <td>plain            </td> <td>can be: 'plain', 'json', 'html'</td> </tr>
			<tr> <td>discard </td> <td>                 </td> <td>Only if method='plain': RegEx for log rows to <b>discard</b> from output</td> </tr>
			<tr> <td>tail    </td> <td>                 </td> <td>Only if method='plain': Print new output if file is changed (on the server side).</td> </tr>
		</table>
		Note: method: 'json', 'html' might be depricated.
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/logtail' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/logtail'>/logtail</a></h5>
		<div class='card-body'>
		(internal): WebSocket feeder if we have <b>tail -f</b> enabled on a file.
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/conf' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/conf?name=ase.GENERIC.conf'>/conf</a></h5>
		<div class='card-body'>
		Get configuration file
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/report' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/report?name=SRVNAME&op=viewLatest'>/report</a></h5>
		<div class='card-body'>
		Access <i>Daily Report</i> files.
		<br>
		Parameters:
		<table>
			<!--     ==========        =================          =========== -->
			<tr> <th>Name    </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========        =================          =========== -->
			<tr> <td>name    </td> <td><b>mandatory</b> </td> <td>Server name to view report for.<br>OR: Full name of the report file (format: srvName.YYYY-MM-DD_hhmm.html, example: <code>DEV_ASE.2019-09-05_0003.html</code>)</td> </tr>
			<tr> <td>op      </td> <td><b>mandatory</b> </td> <td>can be: 'viewLatest', 'view' or 'remove'</td> </tr>
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/download-local-dbxtune' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/download-local-dbxtune'>/download-local-dbxtune</a></h5>
		<div class='card-body'>
		Download the local latest DbxTune ZIP package located at DbxCentral server.<br>
		This could be a later version than the "public" found at the official download page.
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

		
		<!-- ############################################################################# -->
		<div id='/overview' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/overview'>/overview</a></h5>
		<div class='card-body'>
		Get an overview page with all managed server and there statuses
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/logout' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/logout'>/logout</a></h5>
		<div class='card-body'>
		Logout
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/login-check' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/login-check'>/login-check</a></h5>
		<div class='card-body'>
		Check if we a signed-in or not
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->


		<!-- ############################################################################# -->
		<div id='/h2ws' class='card border-dark mb-5'>
		<h5 class='card-header'><a href='/h2ws?filename=DBX_CENTRAL_H2WriterStatCronTask.log&startDate=YYYY-MM-DDThh:mm&endDate=YYYY-MM-DDThh:mm'>/h2ws</a></h5>
		<div class='card-body'>
		H2 Central Writer Statistics (chart info)
		<br>
		Parameters:
		<table>
			<!--     ==========           =================          =========== -->
			<tr> <th>Name       </th> <th>Mandatory/Default</th> <th>Description</th> </tr>
			<!--     ==========           =================          =========== -->
			<tr> <td>filename   </td> <td><b>mandatory</b> </td> <td>Name of the file (only the filename, not full path), probably=DBX_CENTRAL_H2WriterStatCronTask.log</td> </tr>
			<tr> <td>startDate  </td> <td><b>mandatory</b> </td> <td>YYYY-MM-DDThh:mm  <i>date in format: RFC 3339</i></td> </tr>
			<tr> <td>endDate    </td> <td><b>mandatory</b> </td> <td>YYYY-MM-DDThh:mm  <i>date in format: RFC 3339</i></td> </tr>
<!--			<tr> <td>minDuration</td> <td>                 </td> <td>not used for the moment</td> </tr>-->
		</table>
		</div> <!-- end: card-body -->
		</div> <!-- end: card -->

	</div>
	</body>
</html>


